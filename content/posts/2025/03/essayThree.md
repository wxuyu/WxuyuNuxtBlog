---
title: å³åˆ»çŸ­æ–‡çš„ä¸‰ç§éƒ¨ç½²æ–¹æ¡ˆ
description: æœ¬ç¯‡è½¬è½½ä¸‰ç§ä¸åŒæ–¹æ¡ˆï¼ˆå·²ç»æ”¾å¥½åŸæ–‡ç« é“¾æ¥ï¼‰
date: '2025-03-06 12:45'
updated: '2025-03-05 14:09'
cover: https://sourceimage.s3.bitiful.net/img/default_cover_55.avif
category:
  - hexo
top_img: false
tags:
  - hexo
  - butterfly
  - ç¾åŒ–
abbrlink: 2900kf
---
## åŸæ–‡æ¥æº
{% link Butterflyçš„é­”æ”¹æ•™ç¨‹ï¼šå³åˆ»çŸ­æ–‡é¡µ,äº¦å°å°,https://meuicat.com/posts/1cdf15f7.html %}
{% link å³åˆ»çŸ­æ–‡ï¼ˆç€‘å¸ƒæµï¼‰éƒ¨ç½²æ–¹æ¡ˆ,å®‰çŸ¥é±¼,https://blog.anheyu.com/posts/3753.html %}
{% link Heoå³åˆ»çŸ­æ–‡ï¼šåˆ†äº«è‡ªæˆ‘ä¸ç²¾å½©ç”Ÿæ´»,éšé£èµ·,https://blog.bywind.xyz/posts/10b1d3b5.html %}

æ³¨æ„ï¼šæœ¬ç« èŠ‚æ²¡æœ‰bbtalkï¼Œartitalkå’Œispeakï¼ˆé…ç½®éº»çƒ¦ï¼‰ï¼Œå› ä¸ºæ•™ç¨‹æ–¹æ¡ˆæœ‰äº›è€éœ€è¦é¢å¤–å†å‡ºæ•™ç¨‹

## é…ç½®éƒ¨ç½²æ–¹æ¡ˆï¼ˆicatæ–¹æ¡ˆï¼‰
{% note info flat %}
æç¤ºï¼šæ­¤æ–¹æ¡ˆæœ‰ä¸‰ç§ä¸åŒç±»å‹ï¼Œå¯èƒ½å¯¼è‡´æ— æ³•æ­£å¸¸æ˜¾ç¤ºï¼ˆå¯ä»¥é€‰æ‹©å»åŸä½œè€…é‚£é‡ŒæŸ¥çœ‹ï¼Œæœ¬ç¯‡åªæ˜¯æ”¶é›†å¹¶æ•´ç†è¿›æ¥ï¼‰
{% endnote %}
### åŠŸèƒ½å¯¹æ¯”

**todolist**  |	**æœ¬åœ°yml**     | ***åŠ¨æ€JSON**  |	**åŠ¨æ€Memos**
--------------|------------|------------|-----------------------------
**ç€‘å¸ƒæµ**	   | âœ”ï¸æ”¯æŒæ”¯æŒ |	âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**å›¾ç‰‡ç¯ç®±**	 | âœ”ï¸æ”¯æŒæ”¯æŒ |	âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**å¤šå›¾æ˜¾ç¤º**	 | âœ”ï¸æ”¯æŒæ”¯æŒ |	âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**å¤–éƒ¨é“¾æ¥**	 | âœ”ï¸æ”¯æŒæ”¯æŒ |	âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**è‡ªå®šæ ‡è¯†**	 | âœ”ï¸æ”¯æŒ     |	âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**å¿«é€Ÿè¯„è®º**	 | âœ”ï¸æ”¯æŒ     |âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**éŸ³ä¹æ¨¡å—**	 | âœ”ï¸æ”¯æŒ     |âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**è§†é¢‘æ¨¡å—**	 | âœ”ï¸æ”¯æŒ     |âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ
**è¯´è¯´ç½®é¡¶**	 | âœ”ï¸æ”¯æŒ     |âœ”ï¸æ”¯æŒ    |	âœ”ï¸æ”¯æŒ

### éƒ¨ç½²å†ç¨‹
#### åˆ›å»ºæ•°æ®
##### åˆ›å»ºé¡µé¢é…ç½®
åˆ›å»º [blogRoot]/source/essay/index.md é¡µé¢ï¼Œé…ç½®ä»¥ä¸‹å†…å®¹ï¼š
``` MARKDOWN
---
title: å³åˆ»çŸ­æ–‡
date: 2023-01-17 13:38:17
type: essay
top_img: false
aside: false
top_page: true
top_bg: https://img.meuicat.com/banner
top_item: å³åˆ»çŸ­æ–‡
top_title: å°ã®ç¢ç¢å¿µ
top_tips: ä½¿ç”¨ å³åˆ»çŸ­æ–‡åŠ¨æ€éƒ¨ç½²ç‰ˆ æ„å»º
top_link: /about/
top_text: å…³äºåšä¸»
---
```
##### æ–°å»ºé¡µé¢å†…å®¹
(1).æ–°å»ºé¡µé¢é€‰æ‹©ï¼ˆåœ¨é…ç½®æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼‰
åˆ›å»º [blogRoot]/themes/butterfly/layout/includes/page/essay.pug é¡µé¢æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹:
``` PUG
#icat-bber
    section.icat-page
        case theme.essay.mode
            when 'local'
                include ./essay/local.pug
            when 'json'
                include ./essay/json.pug
            when 'memos'
                include ./essay/memos.pug
```
(2).æ–°å»ºé™æ€æœ¬åœ°
åˆ›å»º [blogRoot]/themes/butterfly/layout/includes/page/essay/local.pug é¡µé¢æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
ï¼ˆæ³¨æ„è¯¥é¡µé¢ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ† fontawesome å›¾æ ‡ éœ€è¦è‡ªè¡Œæ›¿æ¢ï¼‰
``` PUG
mixin renderArticle(item)
    .icat-bber-item
        .icat-bber-content
            if item.content
                p.datacont=item.content
            if item.image
                .icat-bber-image
                    each iten, indey in item.image
                        .imgbox
                            - let image = item.image[indey].split('||')
                            img(src=image[0] alt=image[1] ? image[1] : '' title=image[1] ? '' : 'å³åˆ»çŸ­æ–‡é…å›¾' )
            if item.video
                .icat-bber-video
                    if item.video.bilibili
                        - let autoplay = item.video.autoplay ? '&autoplay=1' : '&autoplay=0'
                        - let biliurl = '//player.bilibili.com/player.html?bvid=' + item.video.bilibili.match(/(BV\w+)/)[1] + autoplay
                        iframe(src=biliurl scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true")
                    else if item.video.player
                        video(src=item.video.player controls="controls" style="object-fit: cover;")
            if item.aplayer
                .icat-bber-music
                    meting-js(id=item.aplayer.id server=item.aplayer.server type="song" preload="none" autoplay="false" mutex="true" theme='var(--icat-blue)')
        hr
        .icat-bber-bottom
            .icat-bber-info
                .icat-bber-info-time
                    i.iconfont.icat-time-fill
                    time.datatime(datetime=item.date)= 'Loading'
                if item.from
                    .icat-bber-info-from
                        span=item.from
                if item.link
                    - let link = item.link.split('||')
                    a.icat-bber-content-link(target="_blank" href=link[0] title=link[1] ? link[1] : 'è·³è½¬åˆ°çŸ­æ–‡æŒ‡å¼•çš„é“¾æ¥')
                        i.iconfont.icat-jump-link
                        | é“¾æ¥
                if item.top
                    .icat-bber-info-top
                        i.iconfont.icat-thumbtack
                        | ç½®é¡¶
            if item.content
                .icat-bber-reply(onclick="commentText(" + `'${item.content}'` + ")")
                    i.iconfont.icat-message

#waterfall.list
    if theme.essay.strip === -1
        - var limitedList = site.data.essay.essay_list
    else
        - var limitedList = site.data.essay.essay_list.slice(0, theme.essay.strip)

    - var topArticles = site.data.essay.essay_list.filter(item => item.top === true)
    each item in topArticles
        +renderArticle(item)

    each item in limitedList.filter(item => !item.top)
        +renderArticle(item)

#icat-bber-tips
    if theme.essay.strip === -1 || Math.abs(theme.essay.strip) >= site.data.essay.essay_list.length
        | - å·²å±•å¼€æ‰€æœ‰çŸ­æ–‡ -
    else
        | - åªå±•ç¤ºæœ€è¿‘ #{theme.essay.strip} æ¡çŸ­æ–‡ -
```
(3).æ–°å»ºåŠ¨æ€JSON
æ–°å»º [blogRoot]/themes/butterfly/layout/includes/page/essay/json.pug é¡µé¢æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
ï¼ˆæ³¨æ„è¯¥é¡µé¢ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ† fontawesome å›¾æ ‡ éœ€è¦è‡ªè¡Œæ›¿æ¢ï¼‰
``` PUG
#waterfall.list
    .icat-bber-loading
        img(src="https://img.meuicat.com/blog/loading.svg")
    script.
        (async function () {
            const response = await fetch('!{url_for(theme.essay.mode_link)}');
            const data = await response.json();
            const strip = !{theme.essay.strip};
            let items = [],
                topitem = [],
                essayTips = '';

            const processedData = await Promise.all(data[0].essay_list.map(async (item) => {
                const formatdata = await essayFormat(item);
                if (!formatdata) return null;
                if (item.top) {
                    topitem.push(formatdata);
                } else {
                    items.push(formatdata);
                }
                return formatdata;
            }));

            essayTips = strip === -1 || strip >= items.length ? `<div id="icat-bber-tips">- å·²å±•å¼€æ‰€æœ‰çŸ­æ–‡ -</div>` : (items = items.slice(0, strip), `<div id="icat-bber-tips">- åªå±•ç¤ºæœ€è¿‘ ${strip} æ¡çŸ­æ–‡ -</div>`);

            document.getElementsByClassName('list')[0].innerHTML = topitem.concat(items).filter(item => item !== null).join('');
            document.querySelector(".icat-page").insertAdjacentHTML("beforeend", essayTips);
        })();
        async function essayFormat(item) {
            let image = '',
                video = '',
                type = '';

            if (item.image) item.image.map(e => image += `<div class="imgbox"><img src="${e.split(' || ')[0]}" ${e.split(' || ').length > 1 ? `alt='${e.split(' || ')[1]}'` : `title="å³åˆ»çŸ­æ–‡é…å›¾"`} /></div>`).join('');
            let aplayer = item.aplayer ? `<div class="icat-bber-music"><meting-js server="${item.aplayer.server}" type="song" id="${item.aplayer.id}" mutex="true" preload="none" theme="var(--icat-blue)" data-lrctype="0"></meting-js></div>` : '';
            if (item.video) video = item.video.player ? `<div class="icat-bber-video"><video src="${item.video.player}" controls="controls" style="object-fit: cover;"></video></div>` : item.video.bilibili ? `<div class="icat-bber-video"><iframe src="//player.bilibili.com/player.html?bvid=${item.video.bilibili.match(/(BV\w+)/)[1]}${item.video.autoplay ? '&autoplay=1' : '&autoplay=0'}" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe></div>` : '';
            let link = item.link ? ((type = item.link.split(' || ')), `<a class="icat-bber-content-link" href='${type[0].startsWith('/') ? type[0] : (type[0].startsWith('http') ? type[0] : 'https://' + type[0])}' title="${type.length > 1 ? type[1] : 'è·³è½¬åˆ°çŸ­æ–‡æŒ‡å¼•çš„é“¾æ¥' }" target="_blank"><i class="iconfont icat-jump-link"></i>é“¾æ¥</a>`) : '';
            
            return `
                <div class="icat-bber-item">
                    <div class="icat-bber-content">
                        ${item.content ? `<p class="datacont">${item.content}</p>` : ''}
                        ${image ? `<div class="icat-bber-image">${image}</div>` : ''}
                        ${aplayer}
                        ${video}
                    </div>
                    <hr>
                    <div class="icat-bber-bottom">
                        <div class="icat-bber-info">
                            <div class="icat-bber-info-time">
                                <i class="iconfont icat-time-fill"></i>
                                <time class="datatime" datetime="${item.date}"></time>
                            </div>
                            ${link}
                            ${item.from ? `<div class="icat-bber-info-from"><span>${item.from}</span></div>` : ''}
                            ${item.top ? `<div class="icat-bber-info-top"><i class="iconfont icat-thumbtack"></i>ç½®é¡¶</div>` : ''}
                        </div>
                        ${item.content ? `<div class="icat-bber-reply" onclick="commentText('${item.content}')"><i class="iconfont icat-message"></i></div>` : ''}
                    </div>
                </div>`;
        }
```
(4).æ–°å»ºMEMOSé¡µé¢
åˆ›å»º [blogRoot]/themes/butterfly/layout/includes/page/essay/memos.pug é¡µé¢æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
ï¼ˆæ³¨æ„è¯¥é¡µé¢ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ† fontawesome å›¾æ ‡ éœ€è¦è‡ªè¡Œæ›¿æ¢ï¼‰
``` PUG
#waterfall.list
    .icat-bber-loading
        img(src="https://img.meuicat.com/blog/loading.svg")
    script.
        (async function () {
            let url = '!{url_for(theme.essay.mode_link)}';
            const baseUrl = url.substring(0, url.indexOf("/", url.indexOf("//") + 2));
            const response = await fetch(url);
            const data = await response.json();
            const strip = !{theme.essay.strip};
            let items = [],
                topitem = [],
                essayTips = '';

            const processedData = await Promise.all(data.map(async (item) => {
                const formatdata = await essayFormat(item,baseUrl);
                if (!formatdata) return null;
                if (item.content.includes('#top')) {
                    topitem.push(formatdata);
                } else {
                    items.push(formatdata);
                }
                return formatdata;
            }));

            essayTips = strip === -1 || strip >= items.length ? `<div id="icat-bber-tips">- å·²å±•å¼€æ‰€æœ‰çŸ­æ–‡ -</div>` : (items = items.slice(0, strip), `<div id="icat-bber-tips">- åªå±•ç¤ºæœ€è¿‘ ${strip} æ¡çŸ­æ–‡ -</div>`);

            document.getElementsByClassName('list')[0].innerHTML = topitem.concat(items).filter(item => item !== null).join('');
            document.querySelector(".icat-page").insertAdjacentHTML("beforeend", essayTips);
        })();
        async function essayFormat(item,baseUrl) {
            const contentRegex = /#(.*?)\s|\n/g,
                imageRegex = /\!\[(.*?)\]\((.*?)\)/g,
                playerRegex = /{\s*player\s*(.*)\s*}/g,
                linkRegex = /(?<!\!)\[(.*?)\]\((.*?)\)/g,
                topRegex = /#top/g,
                fromRegex = /(?<![\w\/])(?<!\{)\{([^{}\s]+)\}(?!\})(?![\w\/])/g;
            let time = new Date((item.createdTs - (new Date().getTimezoneOffset() * 60)) * 1000).toISOString(),
                content = item.content,
                image = '',
                img = content.match(imageRegex);
                aplayer = content.match(/{\s*music\s*(.*?)\s*(.*?)\s*}/g),
                video = content.match(playerRegex),
                link = content.match(linkRegex),
                type = '',
                from = content.match(fromRegex);
            
            if (item.resourceList.length) {
                if (!img) img = [];  
                item.resourceList.forEach(e => {
                    if (e.externalLink) img.push(e.externalLink);
                    else img.push(`${baseUrl}/o/r/${e.uid}`);
                });
            }
            if (img) image += img.map(e => `<div class="imgbox"><img src="${e.replace(imageRegex, '$2')}" ${e.replace(imageRegex, '$1') ? `alt="${e.replace(imageRegex, '$1')}"` : `title="å³åˆ»çŸ­æ–‡é…å›¾"`} /></div>`).join('');
            aplayer = aplayer ? `<div class="icat-bber-music"><meting-js server="${aplayer[0].match(/\{\s*music\s*(.*?)\s*\d+\s*\}/)[1]}" type="song" id="${aplayer[0].match(/\d+/)[0]}" mutex="true" preload="none" theme="var(--icat-blue)" data-lrctype="0"></meting-js></div>` : '';
            video = video ? `<div class="icat-bber-video"><video src="${video[0].replace(playerRegex, '$1').trim()}" controls="controls" style="object-fit: cover;"></video></div>` : content.match(/{\s*bilibili\s*(.*?)\s*}/g);
            video = Array.isArray(video) ? `<div class="icat-bber-video"><iframe src="//player.bilibili.com/player.html?bvid=${video[0].match(/(BV\w+)/)[1]}${video[0].match(/{\s*bilibili\s*(.*?)\s*true\s*}/g) ? '&autoplay=1' : '&autoplay=0'}" scrolling="no" border="0" frameborder="no" framespacing="0" allowfullscreen="true"></iframe></div>` : '';
            link = link ? ((type = link[0].replace(linkRegex, '$2')), `<a class="icat-bber-content-link" href='${type.startsWith('/') ? type : (type.startsWith('http') ? type : 'https://' + type)}' title="${link[0].replace(linkRegex, '$1') ? link[0].replace(linkRegex, '$1') : 'è·³è½¬åˆ°çŸ­æ–‡æŒ‡å¼•çš„é“¾æ¥' }" target="_blank"><i class="iconfont icat-jump-link"></i>é“¾æ¥</a>`) : '';
            from = from ? `<div class="icat-bber-info-from"><span>${from[0].replace(fromRegex, '$1')}</span></div>` : '';
            content = content.replace(contentRegex, '').replace(imageRegex, '').replace(/\{(.*?)\}/g, '').replace(linkRegex, '').trim();

            return `
                <div class="icat-bber-item">
                    <div class="icat-bber-content">
                        ${content ? `<p class="datacont">${content}</p>` : ''}
                        ${image ? `<div class="icat-bber-image">${image}</div>` : ''}
                        ${aplayer}
                        ${video}
                    </div>
                    <hr>
                    <div class="icat-bber-bottom">
                        <div class="icat-bber-info">
                            <div class="icat-bber-info-time">
                                <i class="iconfont icat-time-fill"></i>
                                <time class="datatime" datetime="${time}"></time>
                            </div>
                            ${link}
                            ${from}
                            ${item.content.includes('#top') ? `<div class="icat-bber-info-top"><i class="iconfont icat-thumbtack"></i>ç½®é¡¶</div>` : ''}
                        </div>
                        ${content ? `<div class="icat-bber-reply" onclick="commentText('${content}')"><i class="iconfont icat-message"></i></div>` : ''}
                    </div>
                </div>`;
        }
```
(5).ä¿®æ”¹é¡µé¢æ–‡ä»¶ï¼ˆé¡µé¢åŒ¹é…markdownçš„typeï¼‰
ä¿®æ”¹ [blogRoot]/themes/butterfly/layout/page.pug æ¥ä½¿é¡µé¢åŒ¹é…
ï¼ˆ + å·ç›´æ¥åˆ é™¤ å³æ˜¯æ­£å¸¸ç¼©è¿›ï¼‰
``` PUG
      when 'categories'
        include includes/page/categories.pug
+      when 'essay'
+        include includes/page/essay.pug
      default
        include includes/page/default-page.pug
```
(6).å¼€å¯PJAXè®¾ç½®ï¼ˆå¯é€‰ï¼‰
ã€å¯é€‰ã€‘åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­å¼€å¯ç«™ç‚¹çš„ pjax
``` YML
# Pjax
# https://github.com/MoOx/pjax
# å½“ç”¨æˆ·ç‚¹å‡»é“¾æ¥ï¼Œé€šè¿‡ajaxæ›´æ–°é¡µé¢éœ€è¦å˜åŒ–çš„éƒ¨åˆ†ï¼Œç„¶åä½¿ç”¨HTML5çš„pushStateä¿®æ”¹æµè§ˆå™¨çš„URLåœ°å€ï¼›è¿™æ ·å¯ä»¥ä¸ç”¨é‡å¤åŠ è½½ç›¸åŒçš„èµ„æºï¼ˆcss/jsï¼‰ï¼Œ ä»è€Œæå‡ç½‘é¡µçš„åŠ è½½é€Ÿåº¦
# ä½¿ç”¨pjaxåï¼Œä¸€äº›è‡ªå·±DIYçš„jså¯èƒ½ä¼šæ— æ•ˆï¼Œè·³è½¬é¡µé¢æ—¶éœ€è¦é‡æ–°è°ƒç”¨ï¼›ä½¿ç”¨pjaxåï¼Œä¸€äº›ä¸ªåˆ«é¡µé¢åŠ è½½çš„js/cssï¼Œå°†ä¼šæ”¹ä¸ºæ‰€æœ‰é¡µé¢éƒ½åŠ è½½
# --------------------------------------
pjax:
  enable: true
  exclude:
    # - xxxx
    # - xxxx
```
(7).è®¾ç½®æ ·å¼ï¼ˆstylæˆ–è€…cssï¼‰
æ–°å»º [blogRoot]/themes/butterfly/source/css/_page/essay.styl æ ·å¼æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹:
``` STYL
#icat-bber
    margin-top: 1.5rem
    width: 100%

    .icat-page
        #waterfall
            opacity: 0
            transition: .3s

            &.list
                display: flex
                flex-flow: row wrap
                justify-content: space-between

            &.show
                opacity: 1

            .icat-bber-item
                position: relative
                width: 32%
                border: var(--style-border)
                border-radius: 12px
                padding: 1rem 1rem 0.9rem
                transition: all 0.3s ease 0s
                display: flex
                flex-flow: column nowrap
                justify-content: space-between
                align-items: flex-start
                background: var(--icat-card-bg)
                box-shadow: var(--icat-shadow-border)
                margin-right: 2%
                margin-bottom: 1rem
                animation: slide-in .6s .4s backwards

                +maxWidth1024()
                    width: 49%
                    margin-right: 1%

                +maxWidth768()
                    width: 100%
                    margin-right: 0px
                    
                &:hover
                    border-color: var(--icat-blue)

                .icat-bber-content
                    display: flex
                    flex-flow: wrap
                    border-radius: 12px
                    width: 100%
                    height: 100%

                    p
                        margin: 0px

                    .datacont
                        order: 0
                        font-size: 0.8rem
                        font-weight: 700
                        color: var(--icat-fontcolor)
                        width: 100%
                        line-height: 1.38
                        border-radius: 12px
                        margin-bottom: 0.8rem
                        display: flex
                        flex-direction: column
                        text-align: justify
                        padding: 0px 8px

                    .icat-bber-image
                        display: flex
                        gap: 8px
                        width: 100%
                        flex-wrap: wrap
                        margin-bottom: 10px
                        padding-left: 8px

                        .imgbox
                            width: calc(100% / 4 - 8px)
                            aspect-ratio: 1 / 1
                            overflow: hidden
                            border-radius: 6px

                            a
                                height: 100px
                                display: flex
                                position: relative

                                img
                                    object-fit: cover
                                    width: 100%
                                    max-height: 100%
                                    border-radius: 6px
                                    animation: slide-in .6s .4s backwards

                    .icat-bber-video
                        position: relative
                        padding: 30% 50%
                        margin-bottom: 10px

                        video,
                        iframe
                            position: absolute
                            width: 100%
                            height: 100%
                            left: 0
                            top: 0
                            margin: 0
                            border-radius: 6px
                            border: var(--style-border)

                    .icat-bber-music
                        width: 100%
                        height: 90px
                        margin: 0 0 0.5rem
                        border-radius: 8px
                        overflow: hidden
                        border: var(--style-border)
                        background: var(--icat-secondbg)

                hr
                    display: flex
                    position: relative
                    margin: 8px 0px
                    border: 1px dashed var(--icat-blue)
                    width: 100%
                    opacity: 0.4

                .icat-bber-bottom
                    display: flex
                    justify-content: space-between
                    width: 100%
                    margin-top: 10px
                    user-select: none

                    .icat-bber-info
                        display: flex

                        .icat-bber-info-time
                            color: var(--icat-fontcolor)
                            font-size: 0.7rem
                            background-color: var(--icat-gray-op)
                            padding: 8px
                            border-radius: 20px
                            cursor: default
                            display: flex
                            align-items: center
                            padding-right: 12px
                            line-height: 1

                            i
                                padding-right: 4px

                        .icat-bber-info-from
                            @extend .icat-bber-info-time
                            margin-left: 0.5rem

                            span
                                margin-left: 0.35rem

                        .icat-bber-content-link
                            display: flex
                            margin-left: 0.5rem
                            font-size: 0.7rem
                            align-items: center
                            background-color: rgba(103, 194, 58, 0.13)
                            color: rgb(103, 194, 58)
                            padding: 0px 8px
                            border-radius: 20px
                            padding-right: 10px
                            line-height: 1

                            i
                                margin-right: 4px

                            &:hover
                                background-color: var(--icat-blue)
                                color: var(--icat-white)

                        .icat-bber-info-top
                            background-color: rgba(245, 108, 108, 0.13)
                            color: rgb(245, 108, 108)
                            display: flex
                            margin-left: 0.5rem
                            font-size: 0.7rem
                            align-items: center
                            padding: 0px 8px
                            border-radius: 20px
                            padding-right: 10px
                            line-height: 1

                            i
                                margin-right: 4px
                                font-size: 14px
                                transform: rotateZ(35deg)

                    .icat-bber-reply
                        cursor: pointer
                        transition: .6s

                        &:hover
                            color: var(--icat-blue)

        #icat-bber-tips
            font-size: 14px
            display: flex
            justify-content: center
            margin-bottom: 2rem
            color: var(--icat-secondtext)
    
    .icat-bber-loading
        position: revert !important
        margin: 0 auto

    .aplayer
        margin: 0

        &.aplayer-withlrc
            .aplayer-pic
                height: 82px
                width: 82px
                margin: 3px
                border-radius: 4px

            .aplayer-info
                margin-left: 84px
                padding: 5px 7px 0

                .aplayer-music
                    height: 23px
                    text-align: center

                    .aplayer-title
                        font-size: 0.8rem
                        font-weight: 700
                        margin: 0
                        color: var(--icat-fontcolor)

                .aplayer-controller
                    align-items: center

                    .aplayer-bar-wrap
                        padding: 0

                        .aplayer-bar
                            background: var(--icat-gray)
                            height: 8px
                            border-radius: 12px
                            transition: 0.3s
                            overflow: hidden

                            .aplayer-loaded
                                height: 100%
                                border-radius: 12px

                            .aplayer-played
                                height: 100%
                                border-radius: 12px

                                .aplayer-thumb
                                    display: none

                    .aplayer-time
                        position: initial

        .aplayer-lrc
            height: 36px
            margin: -12px 0 3px

            &::after
                height: 20%
            &::before
                height: 4%

            p
                color: var(--icat-fontcolor)

[data-theme='dark']
    #icat-bber
        .icat-page
            #waterfall
                .icat-bber-item
                    hr
                        opacity: 0.2
            
            .icat-bber-music .aplayer,
            .aplayer .aplayer-lrc:before,
            .aplayer .aplayer-lrc:after
                background: var(--icat-card-bg)
                color: var(--icat-fontcolor)
```
{% folding cyan, å¯é€‰CSSæ ·å¼ %}
æ–°å»º [blogRoot]/source/css/essay.css æ ·å¼æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
ï¼ˆä¹Ÿå¯ä»¥åœ¨è‡ªå»ºçš„cssæ–‡ä»¶é‡Œæ–°å¢å†…å®¹ï¼‰
``` CSS
#icat-bber {
  margin-top: 1.5rem;
  width: 100%;
}
#icat-bber .icat-page #waterfall {
  opacity: 0;
  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
  filter: alpha(opacity=0);
  -webkit-transition: 0.3s;
  -moz-transition: 0.3s;
  -o-transition: 0.3s;
  -ms-transition: 0.3s;
  transition: 0.3s;
}
#icat-bber .icat-page #waterfall.list {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-orient: horizontal;
  -moz-box-orient: horizontal;
  -o-box-orient: horizontal;
  -webkit-box-lines: multiple;
  -moz-box-lines: multiple;
  -o-box-lines: multiple;
  -webkit-flex-flow: row wrap;
  -ms-flex-flow: row wrap;
  flex-flow: row wrap;
  -webkit-box-pack: justify;
  -moz-box-pack: justify;
  -o-box-pack: justify;
  -ms-flex-pack: justify;
  -webkit-justify-content: space-between;
  justify-content: space-between;
}
#icat-bber .icat-page #waterfall.show {
  opacity: 1;
  -ms-filter: none;
  filter: none;
}
#icat-bber .icat-page #waterfall .icat-bber-item {
  position: relative;
  width: 32%;
  border: var(--style-border);
  border-radius: 12px;
  padding: 1rem 1rem 0.9rem;
  -webkit-transition: all 0.3s ease 0s;
  -moz-transition: all 0.3s ease 0s;
  -o-transition: all 0.3s ease 0s;
  -ms-transition: all 0.3s ease 0s;
  transition: all 0.3s ease 0s;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -o-box-orient: vertical;
  -webkit-box-lines: single;
  -moz-box-lines: single;
  -o-box-lines: single;
  -webkit-flex-flow: column nowrap;
  -ms-flex-flow: column nowrap;
  flex-flow: column nowrap;
  -webkit-box-pack: justify;
  -moz-box-pack: justify;
  -o-box-pack: justify;
  -ms-flex-pack: justify;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  -webkit-box-align: start;
  -moz-box-align: start;
  -o-box-align: start;
  -ms-flex-align: start;
  -webkit-align-items: flex-start;
  align-items: flex-start;
  background: var(--icat-card-bg);
  -webkit-box-shadow: var(--icat-shadow-border);
  box-shadow: var(--icat-shadow-border);
  margin-right: 2%;
  margin-bottom: 1rem;
  -webkit-animation: slide-in 0.6s 0.4s backwards;
  -moz-animation: slide-in 0.6s 0.4s backwards;
  -o-animation: slide-in 0.6s 0.4s backwards;
  -ms-animation: slide-in 0.6s 0.4s backwards;
  animation: slide-in 0.6s 0.4s backwards;
}
@media screen and (max-width: 1024px) {
  #icat-bber .icat-page #waterfall .icat-bber-item {
    width: 49%;
    margin-right: 1%;
  }
}
@media screen and (max-width: 768px) {
  #icat-bber .icat-page #waterfall .icat-bber-item {
    width: 100%;
    margin-right: 0px;
  }
}
#icat-bber .icat-page #waterfall .icat-bber-item:hover {
  border-color: var(--icat-blue);
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-lines: multiple;
  -moz-box-lines: multiple;
  -o-box-lines: multiple;
  -webkit-flex-flow: wrap;
  -ms-flex-flow: wrap;
  flex-flow: wrap;
  border-radius: 12px;
  width: 100%;
  height: 100%;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content p {
  margin: 0px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .datacont {
  -webkit-box-ordinal-group: 0;
  -moz-box-ordinal-group: 0;
  -o-box-ordinal-group: 0;
  -ms-flex-order: 0;
  -webkit-order: 0;
  order: 0;
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--icat-fontcolor);
  width: 100%;
  line-height: 1.38;
  border-radius: 12px;
  margin-bottom: 0.8rem;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -o-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
  text-align: justify;
  padding: 0px 8px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-image {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  gap: 8px;
  width: 100%;
  -webkit-box-lines: multiple;
  -moz-box-lines: multiple;
  -o-box-lines: multiple;
  -webkit-flex-wrap: wrap;
  -ms-flex-wrap: wrap;
  flex-wrap: wrap;
  margin-bottom: 10px;
  padding-left: 8px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-image .imgbox {
  width: calc(100% / 4 - 8px);
  aspect-ratio: 1/1;
  overflow: hidden;
  border-radius: 6px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-image .imgbox a {
  height: 100px;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  position: relative;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-image .imgbox a img {
  object-fit: cover;
  width: 100%;
  max-height: 100%;
  border-radius: 6px;
  -webkit-animation: slide-in 0.6s 0.4s backwards;
  -moz-animation: slide-in 0.6s 0.4s backwards;
  -o-animation: slide-in 0.6s 0.4s backwards;
  -ms-animation: slide-in 0.6s 0.4s backwards;
  animation: slide-in 0.6s 0.4s backwards;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-video {
  position: relative;
  padding: 30% 50%;
  margin-bottom: 10px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-video video,
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-video iframe {
  position: absolute;
  width: 100%;
  height: 100%;
  left: 0;
  top: 0;
  margin: 0;
  border-radius: 6px;
  border: var(--style-border);
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-content .icat-bber-music {
  width: 100%;
  height: 90px;
  margin: 0 0 0.5rem;
  border-radius: 8px;
  overflow: hidden;
  border: var(--style-border);
  background: var(--icat-secondbg);
}
#icat-bber .icat-page #waterfall .icat-bber-item hr {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  position: relative;
  margin: 8px 0px;
  border: 1px dashed var(--icat-blue);
  width: 100%;
  opacity: 0.4;
  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=40)";
  filter: alpha(opacity=40);
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-pack: justify;
  -moz-box-pack: justify;
  -o-box-pack: justify;
  -ms-flex-pack: justify;
  -webkit-justify-content: space-between;
  justify-content: space-between;
  width: 100%;
  margin-top: 10px;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-time,
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-from {
  color: var(--icat-fontcolor);
  font-size: 0.7rem;
  background-color: var(--icat-gray-op);
  padding: 8px;
  border-radius: 20px;
  cursor: default;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-align: center;
  -moz-box-align: center;
  -o-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
  padding-right: 12px;
  line-height: 1;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-time i,
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-from i {
  padding-right: 4px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-from {
  margin-left: 0.5rem;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-from span {
  margin-left: 0.35rem;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-content-link {
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  margin-left: 0.5rem;
  font-size: 0.7rem;
  -webkit-box-align: center;
  -moz-box-align: center;
  -o-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
  background-color: rgba(103,194,58,0.13);
  color: #67c23a;
  padding: 0px 8px;
  border-radius: 20px;
  padding-right: 10px;
  line-height: 1;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-content-link i {
  margin-right: 4px;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-content-link:hover {
  background-color: var(--icat-blue);
  color: var(--icat-white);
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-top {
  background-color: rgba(245,108,108,0.13);
  color: #f56c6c;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  margin-left: 0.5rem;
  font-size: 0.7rem;
  -webkit-box-align: center;
  -moz-box-align: center;
  -o-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
  padding: 0px 8px;
  border-radius: 20px;
  padding-right: 10px;
  line-height: 1;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-info .icat-bber-info-top i {
  margin-right: 4px;
  font-size: 14px;
  -webkit-transform: rotateZ(35deg);
  -moz-transform: rotateZ(35deg);
  -o-transform: rotateZ(35deg);
  -ms-transform: rotateZ(35deg);
  transform: rotateZ(35deg);
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-reply {
  cursor: pointer;
  -webkit-transition: 0.6s;
  -moz-transition: 0.6s;
  -o-transition: 0.6s;
  -ms-transition: 0.6s;
  transition: 0.6s;
}
#icat-bber .icat-page #waterfall .icat-bber-item .icat-bber-bottom .icat-bber-reply:hover {
  color: var(--icat-blue);
}
#icat-bber .icat-page #icat-bber-tips {
  font-size: 14px;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-pack: center;
  -moz-box-pack: center;
  -o-box-pack: center;
  -ms-flex-pack: center;
  -webkit-justify-content: center;
  justify-content: center;
  margin-bottom: 2rem;
  color: var(--icat-secondtext);
}
#icat-bber .icat-bber-loading {
  position: revert !important;
  margin: 0 auto;
}
#icat-bber .aplayer {
  margin: 0;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-pic {
  height: 82px;
  width: 82px;
  margin: 3px;
  border-radius: 4px;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info {
  margin-left: 84px;
  padding: 5px 7px 0;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-music {
  height: 23px;
  text-align: center;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-music .aplayer-title {
  font-size: 0.8rem;
  font-weight: 700;
  margin: 0;
  color: var(--icat-fontcolor);
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller {
  -webkit-box-align: center;
  -moz-box-align: center;
  -o-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-bar-wrap {
  padding: 0;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar {
  background: var(--icat-gray);
  height: 8px;
  border-radius: 12px;
  -webkit-transition: 0.3s;
  -moz-transition: 0.3s;
  -o-transition: 0.3s;
  -ms-transition: 0.3s;
  transition: 0.3s;
  overflow: hidden;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-loaded {
  height: 100%;
  border-radius: 12px;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-played {
  height: 100%;
  border-radius: 12px;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-played .aplayer-thumb {
  display: none;
}
#icat-bber .aplayer.aplayer-withlrc .aplayer-info .aplayer-controller .aplayer-time {
  position: initial;
}
#icat-bber .aplayer .aplayer-lrc {
  height: 36px;
  margin: -12px 0 3px;
}
#icat-bber .aplayer .aplayer-lrc::after {
  height: 20%;
}
#icat-bber .aplayer .aplayer-lrc::before {
  height: 4%;
}
#icat-bber .aplayer .aplayer-lrc p {
  color: var(--icat-fontcolor);
}
[data-theme='dark'] #icat-bber .icat-page #waterfall .icat-bber-item hr {
  opacity: 0.2;
  -ms-filter: "progid:DXImageTransform.Microsoft.Alpha(Opacity=20)";
  filter: alpha(opacity=20);
}
[data-theme='dark'] #icat-bber .icat-page .icat-bber-music .aplayer,
[data-theme='dark'] #icat-bber .icat-page .aplayer .aplayer-lrc:before,
[data-theme='dark'] #icat-bber .icat-page .aplayer .aplayer-lrc:after {
  background: var(--icat-card-bg);
  color: var(--icat-fontcolor);
}

/* å³åˆ»çŸ­æ–‡æ ·å¼ */
```
(8).æ·»åŠ cssæ ·å¼åˆ°é…ç½®æ–‡ä»¶
åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ inject ä¸‹çš„ head å¼•å…¥ essay.css æ ·å¼æ–‡ä»¶:
``` YML
  Â·Â·Â·

inject:
  head:
    - <link rel="stylesheet" href="/css/essay.css"> # å³åˆ»çŸ­æ–‡æ ·å¼
  bottom:
    - Â·Â·Â·

  Â·Â·Â·
```
{% endfolding %}

(9).æ–°å»ºjsæ–‡ä»¶
åˆ›å»º [blogRoot]/source/js/essay.js æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹ï¼Œç”¨æ¥å¤„ç†å³åˆ»çŸ­æ–‡çš„é€»è¾‘
ï¼ˆæˆ–å†™åœ¨è‡ªå»ºçš„å…¬å…± js ä¸­ä¹Ÿå¯ä»¥ï¼‰
``` JS
function whenDOMReady() {
  if (location.pathname == '/essay/') document.addEventListener('DOMContentLoaded', function () {setTimeout(() => { changeTime(), btf.loadLightbox(document.querySelectorAll('#icat-bber img')), window.lazyLoadInstance && window.lazyLoadInstance.update(), reflashWaterFall();}, 300)})
}
whenDOMReady()
document.addEventListener("pjax:complete", whenDOMReady)

// é€‚é…pjax

window.onresize = () => {
  waterfall('#waterfall');
};

// è‡ªé€‚åº”

function timeDiff(timeObj, today) => {
  const timeObjUTC = Date.UTC(timeObj.getFullYear(), timeObj.getMonth(), timeObj.getDate());
  const todayUTC = Date.UTC(today.getFullYear(), today.getMonth(), today.getDate());

  const timeDiff = todayUTC - timeObjUTC;
  return Math.floor(timeDiff / (1000 * 3600 * 24));
}
function changeTime() {
  const timeElements = Array.from(document.getElementsByTagName("time"));
  const currentDate = new Date();

  timeElements.forEach(timeElement => {
    const datetime = timeElement.getAttribute("datetime");
    const timeObj = new Date(datetime);
    const daysDiff = timeDiff(timeObj, currentDate);

    let timeString;
    if (daysDiff === 0) {
      timeString = `æœ€è¿‘`;
    } else if (daysDiff === 1) {
      timeString = `æ˜¨å¤©`;
    } else if (daysDiff === 2) {
      timeString = `å‰å¤©`;
    } else if (daysDiff <= 7) {
      timeString = `${daysDiff}å¤©å‰`;
    } else {
      if (timeObj.getFullYear() !== currentDate.getFullYear()) {
        timeString = `${timeObj.getFullYear()}/${timeObj.getMonth() + 1}/${timeObj.getDate()}`;
      } else {
        timeString = `${timeObj.getMonth() + 1}/${timeObj.getDate()}`;
      }
    }
    timeElement.textContent = timeString;
  });
}
function reflashWaterFall() {
  document.querySelector("#waterfall") &&
    setTimeout(function() {
      waterfall("#waterfall");
      document.getElementById("waterfall")
        .classList.add("show");
    }, 500);
} // åŠ è½½æ˜¾ç¤º - å³åˆ»çŸ­æ–‡
function commentText(txt) {
  const inputs = ["#wl-edit", ".el-textarea__inner"];
  for (let i = 0; i < inputs.length; i++) {
    let el = document.querySelector(inputs[i]);
    if (el != null) {
      el.dispatchEvent(new Event('input', { bubble: true, cancelable: true }));
      el.value = '> ' + txt.replace(/\n/g, '\n> ') + '\n\n';
      el.focus();
      el.setSelectionRange(-1, -1);
    }
  }
} // å¼•ç”¨è¯„è®ºè·³è½¬ - å³åˆ»çŸ­æ–‡
```
åˆ›å»º [blogRoot]/source/js/waterfall.js æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹ï¼Œç”¨äºå¤„ç†ç€‘å¸ƒæµ
ï¼ˆæˆ–å†™åœ¨å…¬å…± js ä¸­ä¹Ÿå¯ä»¥ï¼‰
``` JS
function waterfall(a) {
  function b(a, b) {
    var c = window.getComputedStyle(b);
    return parseFloat(c["margin" + a]) || 0;
  }
  function c(a) {
    return a + "px";
  }
  function d(a) {
    return parseFloat(a.style.top);
  }
  function e(a) {
    return parseFloat(a.style.left);
  }
  function f(a) {
    return a.clientWidth;
  }
  function g(a) {
    return a.clientHeight;
  }
  function h(a) {
    return d(a) + g(a) + b("Bottom", a);
  }
  function i(a) {
    return e(a) + f(a) + b("Right", a);
  }
  function j(a) {
    a = a.sort(function (a, b) {
      return h(a) === h(b) ? e(b) - e(a) : h(b) - h(a);
    });
  }
  function k(b) {
    f(a) != t && (b.target.removeEventListener(b.type, arguments.callee), waterfall(a));
  }
  "string" == typeof a && (a = document.querySelector(a));
  var l = [].map.call(a.children, function (a) {
    return (a.style.position = "absolute"), a;
  });
  a.style.position = "relative";
  var m = [];
  l.length && ((l[0].style.top = "0px"), (l[0].style.left = c(b("Left", l[0]))), m.push(l[0]));
  for (var n = 1; n < l.length; n++) {
    var o = l[n - 1],
      p = l[n],
      q = i(o) + f(p) <= f(a);
    if (!q) break;
    (p.style.top = o.style.top), (p.style.left = c(i(o) + b("Left", p))), m.push(p);
  }
  for (; n < l.length; n++) {
    j(m);
    var p = l[n],
      r = m.pop();
    (p.style.top = c(h(r) + b("Top", p))), (p.style.left = c(e(r))), m.push(p);
  }
  j(m);
  var s = m[0];
  a.style.height = c(h(s) + b("Bottom", s));
  var t = f(a);
  window.addEventListener ? window.addEventListener("resize", k) : (document.body.onresize = k);
}
```
(10).å¼•å…¥jsæ–‡ä»¶
åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ inject ä¸‹çš„ bottom å¼•å…¥ essay.js å’Œ waterfall.js
``` YML
  Â·Â·Â·

inject:
  head:
    - Â·Â·Â·
  bottom:
    - <script async src="/js/waterfall.js"></script> # ç€‘å¸ƒæµJS
    - <script defer src="/js/essay.js"></script> # å³åˆ»é€»è¾‘æ–‡ä»¶

  Â·Â·Â·
```
(11).æ·»åŠ ä»¥ä¸‹é…ç½®
åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ï¼Œæ–°å¢ä»¥ä¸‹é…ç½®é¡¹
``` YML
# essay å³åˆ»çŸ­æ–‡
# MeuiCatè®¾è®¡
# https://meuicat.com/blog/67/
# --------------------------------------

essay:
  enable: true
  # å³åˆ»çŸ­æ–‡ä»…å±•ç¤ºå‰næ¡
  # Jike short text only shows the first n
  strip: 50
  mode: memos # localï¼šæœ¬åœ°é™æ€ / jsonï¼šåŠ¨æ€json / memosï¼šåŠ¨æ€Memos
  mode_link: https://memos.meuicat.com/api/v1/memo?creatorId=1&tag=è¯´è¯´ #åŠ¨æ€æ¨¡å¼åœ°å€
```
#### åˆ›å»ºæ•°æ®å†…å®¹

{% tabs æ•°æ®æ¨¡å¼ %}

<!-- tab æœ¬åœ°é™æ€ -->
åˆ›å»º [blogRoot]/source/_data/essay.yml æ–‡ä»¶ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
``` YML
essay_list:
  - content: å³åˆ»çŸ­æ–‡æµ‹è¯•
    date: 2023/07/31 15:30:50
    from: iPhone XR
    video: 
      player: /video/1.mp4

  - content: æµ‹è¯•bilibiliè§†é¢‘
    date: 2023/07/31 15:30:50
    video: 
      bilibili: //player.bilibili.com/player.html?aid=913951276&bvid=BV1RM4y1p75T&cid=1211165267&page=1

  - content: bilibiliç½‘é¡µé“¾æ¥
    date: 2023/07/31 15:30:50
    video: 
      bilibili: https://www.bilibili.com/video/BV17T4y1A7eW/?spm_id_from=333.1007.tianma.1-3-3.click

  - content: bilibiliå•bvå·
    date: 2023/07/31 15:30:50
    video: 
      bilibili: BV17T4y1A7eW
      autoplay: true

  - content: å®Œå™œ è¿˜å‰©ä¸€å¤©è®©æˆ‘å’‹å‡†å¤‡ ğŸ˜­
    date: 2023/05/11 20:35:42
    from: iPhone XR
    image: 
      - https://s11.ax1x.com/2023/05/11/p9sKEh8.jpg

  - content: å¦‚æœè¦å®šä¹‰ é‚£å°±æ˜¯ä¸‹ç­åçš„æ—¥è½å’Œåœ¨å®¶ç­‰æˆ‘ä¸‹ç­çš„å¥¹~
    date: 2023/05/10 16:16:15
    aplayer:
      server: netease
      id: 1949516216
    top: true

  - content: Melancholia - æ¬­ | ä¸€æ¬¾çº¯è®°å½•å†™ä½œç±»Hexoä¸»é¢˜ âœï¸
    date: 2023/04/23 22:27:22
    from: Macbook Pro
    link: https://github.com/yife68/Hexo-Theme-Melancholia || Melancholia

  - content: çˆ±çœ‹ ä½†è¿˜æ˜¯å¾—åƒæˆ‘ä¸€æ‹³
    date: 2023/04/22 15:10:30
    from: iPhone XR
    image: 
      - https://s11.ax1x.com/2023/05/03/p9JqGXd.jpg
      - https://s11.ax1x.com/2023/05/03/p9Jq86H.jpg

  - content: iCat æ–°å¯ç¨‹
    date: 2023/03/24 16:54:25
    from: iPhone XR
    link: https://meuicat.com/blog/14/
    image: 
      - https://s11.ax1x.com/2023/05/02/p9GosYQ.jpg

  - content: å„ç§è§‚å½±å²é›†äºä¸€ä½“ï¼äººç”Ÿè¶³è¿¹é¡µè¯ç”Ÿå’¯~
    date: 2023/02/19 14:50:17
    from: Macbook Pro
    link: /collect/ || é“¾æ¥æè¿°
```
<!-- endtab -->

<!-- tab åŠ¨æ€json -->
JSONæ–‡ä»¶å¯å‚ç…§ä»¥ä¸‹æ ¼å¼
``` JSON
[
   {
      "class_name": "å³åˆ»çŸ­æ–‡",
      "essay_list": [
          {
            "content": "å›­é•¿æ–°é€ å‹ï¼çˆ±æ­»",
            "date": "2023/08/01 17:12:30",
            "video": {
                "bilibili": "//player.bilibili.com/player.html?aid=701381935&bvid=BV1dm4y1L7vj&cid=1212026428&page=1",
                "autoplay": true
            }
         },
         {
            "content": "è¿™è¾ˆå­éƒ½ä¸æƒ³å®Œå–„é¡¹ç›®äº† ğŸ˜­ ä¸¤ç‚¹äº† ä¸€çœ‹æ‰æ“å®Œä¸‰åˆ†ä¹‹ä¸€..",
            "date": "2023/08/01 02:02:44",
            "video": {
                "player": "https://meuicat.com/video/1.mp4"
            }
         },
         {
            "content": "è®©æˆ‘çœ‹çœ‹æ˜¯è°åœ¨è·¯ä¸Šéƒ½è¿˜åœ¨æ•²é”®ç›˜ å™¢ åŸæ¥æ˜¯æˆ‘è‡ªå·±å•Š..",
            "date": "2023/07/31 15:54:26",
            "from": "iPhone XR"
         },
         {
            "content": "è½ç­ çƒ§ä¸ªæ’éª¨778~",
            "date": "2023/07/26 17:55:36",
            "from": "iPhone XR",
            "image": [
               "https://s11.ax1x.com/2023/07/26/pCjWbY4.jpg || å›¾ç‰‡æè¿°",
               "https://s11.ax1x.com/2023/07/26/pCjWqfJ.jpg"
            ]
         },
         {
            "content": "å˜˜..å¬æ­Œ..ç¡è§‰...",
            "date": "2023/07/20 00:38:41",
            "aplayer": {
               "server": "netease",
               "id": "1430702919"
            },
            "top": true
         },
         {
            "content": "äººç”Ÿåº”è¯¥æ˜¯ä¸€ä¸ªè½´å¯¹ç§°çš„å½¢çŠ¶ï¼Œæœ€åå¤±å»çš„ï¼Œä¹Ÿå°±æ˜¯æœ€å¼€å§‹æ‹¥æœ‰çš„ã€‚ç°åœ¨æ²¡äººè®°å¾—ä½ çš„ç”Ÿæ—¥ï¼Œæœ‰å¥½å¤„ä¹Ÿæœ‰åå¤„ï¼Œè‡³å°‘æˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ã€‚ä½†æ— è®ºæ˜¯å¥½è¿˜æ˜¯åï¼Œå¿ä¸€å¿ï¼Œéƒ½ä¼šå¾ˆå¿«è¿‡å»çš„",
            "date": "2023/07/19 01:48:36",
            "from": "iPhone XR",
            "link": "/blog/64 || é“¾æ¥æè¿°"
         },
         {
            "content": "ç”¨å †AIé‡ç»˜ä¸€ä¸‹æˆ‘æœ€çˆ±çš„å¤´åƒï¼ˆå›¾ä¸€ ğŸ‘‰ å›¾äºŒï¼‰",
            "date": "2023/07/06 16:30:32",
            "from": "iPhone XR",
            "link": "/blog/61",
            "image": [
               "https://img.meuicat.com/posts/2023/7/10.webp",
               "https://img.meuicat.com/posts/2023/7/11.webp"
            ]
         },
         {
            "content": "",
            "date": "2023/06/30 08:26:22",
            "aplayer": {
               "server": "netease",
               "id": "2009974513"
            }
         }
      ]
   }
]
```

<!-- endtab -->

<!-- tab åŠ¨æ€memos -->
Memosç”¨æ³•ï¼š
``` MARKDOWN
#è¯´è¯´ {æ ‡è¯†ç¬¦} æˆ‘æ˜¯å†…å®¹ [æˆ‘æ˜¯é“¾æ¥](https://meuicat.com) ![](https://img.meuicat.cn/blog/8.png)
<!-- å¸¸è§„å†™æ³• -->

#è¯´è¯´ ç½‘æ˜“äº‘éŸ³ä¹ {music netease 29947420 }
#è¯´è¯´ è…¾è®¯éŸ³ä¹ {music tencent 330977131 }
<!-- éŸ³ä¹å†™æ³• -->

#è¯´è¯´ æ™®é€šè§†é¢‘ { player https://v.meuicat.com/video/1.mp4 }
#è¯´è¯´ å“”å“©å“”å“©æ‰‹æœºè§†é¢‘ { bilibili https://m.bilibili.com/video/BV17T4y1A7eW }
#è¯´è¯´ å“”å“©å“”å“©ç½‘é¡µè§†é¢‘ { bilibili https://www.bilibili.com/video/BV17T4y1A7eW/?spm_id_from=333.1007.tianma.1-3-3.click }
<!-- è§†é¢‘å†™æ³• -->

#è¯´è¯´ #top
æˆ‘æ˜¯å†…å®¹ ![æˆ‘æ˜¯å›¾ç‰‡æè¿°](https://img.meuicat.cn/blog/8.png)![](https://img.meuicat.cn/blog/8.png)
<!-- ç½®é¡¶å†™æ³• -->
```
<!-- endtab -->

{% endtabs %}

#### å³åˆ»Mini
(1).åˆ›å»ºé¡µé¢å†…å®¹
æ–°å¢ [blogRoot]/themes/butterfly/layout/includes/mixins/post-ui.pug é¡µé¢å†…å®¹
ï¼ˆ + å·ç›´æ¥åˆ é™¤ å³æ˜¯æ­£å¸¸ç¼©è¿›ï¼‰
``` PUG
mixin postUI(posts)
  - let newTitle= newPost()
+  if theme.essay.enable && theme.essay.home_mini
+    include ./essay_mini.pug
  each article , index in page.posts.data
    .recent-post-item
  
  Â·Â·Â·
```
åˆ›å»º [blogRoot]/themes/butterfly/layout/includes/mixins/essay_mini.pug é¡µé¢ï¼Œå¹¶æ–°å¢ä»¥ä¸‹å†…å®¹
ï¼ˆæ³¨æ„è¯¥å†…å®¹ä¸­ fontawesome å›¾æ ‡ éœ€è¦è‡ªè¡Œæ›¿æ¢ï¼‰
``` PUG
.essay-mini
    i.iconfont.icat-essay-mini(onclick=`pjax.loadUrl('${theme.essay.home_mini_link}')` title="å³åˆ»çŸ­æ–‡" style="font-size: 2.25rem; margin-right: 1rem")
    .swiper-container.swiper-no-swiping#Essay(tabindex="-1" onclick=`pjax.loadUrl('${theme.essay.home_mini_link}')`)
        .swiper-wrapper#essay-mini
.essay-mini.wow.animation-slide-in(data-wow-duration="1s" data-wow-delay="200ms" data-wow-offset="100" data-wow-iteration="1")
    i.iconfont.icat-essay-mini(onclick=`pjax.loadUrl('${theme.essay.home_mini_link}')` title="å³åˆ»çŸ­æ–‡" style="font-size: 2.25rem; margin-right: 1rem")
    .swiper-container.swiper-no-swiping#Essay(tabindex="-1" onclick=`pjax.loadUrl('${theme.essay.home_mini_link}')`)
        .swiper-wrapper#essay-mini
            case theme.essay.mode
                when 'local'
                    each item, i in site.data.essay.essay_list.slice(0, 10)
                        .li-style.swiper-slide
                            | #{item.content}
                            if item.image
                                | ã€å›¾ç‰‡ã€‘
                            else if item.aplayer
                                | ã€éŸ³ä¹ã€‘
                            else if item.video || item.bilibili
                                | ã€è§†é¢‘ã€‘
                when 'json'
                    .li-style.essay-loading(style="text-align: center") æ­£åœ¨åŠ è½½...
                    script.
                        (async function () {
                            const response = await fetch('!{url_for(theme.essay.mode_link)}');
                            const data = await response.json();
                            const list = data[0].essay_list.slice(0, 10).map(item => {
                                let type = item.image ? 'ã€å›¾ç‰‡ã€‘' : item.aplayer ? 'ã€éŸ³ä¹ã€‘' : item.video ? 'ã€è§†é¢‘ã€‘' : '';
                                return `<div class="li-style swiper-slide">${item.content + type}</div>`
                            });
                            document.querySelector('#essay-mini').innerHTML = list.join(' ');
                        })()
                when 'memos'
                    .li-style.essay-loading(style="text-align: center") æ­£åœ¨åŠ è½½...
                    script.
                        (async function () {
                            const response = await fetch('!{url_for(theme.essay.mode_link)}');
                            const data = await response.json();
                            const list = data.slice(0, 10).map(item => {
                                let data = item.content,
                                    content = data.replace(/#(.*?)\s|\n/g, '').replace(/\!\[(.*?)\]\((.*?)\)/g, '').replace(/\{(.*?)\}/g, '').replace(/(?<!\!)\[(.*?)\]\((.*?)\)/g, '').trim();
                                    type = data.match(/\!\[(.*?)\]\((.*?)\)/g) ? 'ã€å›¾ç‰‡ã€‘' : data.match(/{\s*music\s*(.*?)\s*(.*?)\s*}/g) ? 'ã€éŸ³ä¹ã€‘' : data.match(/{\s*player\s*(.*)\s*}/g) || data.match(/{\s*bilibili\s*(.*?)\s*}/g) ? 'ã€è§†é¢‘ã€‘' : '';
                                return `<div class="li-style swiper-slide">${content + type}</div>`
                            });
                            document.querySelector('#essay-mini').innerHTML = list.join(' ');
                        })()
    i.iconfont.icat-right-btn(title="æŸ¥çœ‹å…¨æ–‡" onclick=`pjax.loadUrl('${theme.essay.home_mini_link}')` style="margin-left: 1rem")
```
(2).æ–°å»ºæ ·å¼æ–‡ä»¶

æ–°å»º [blogRoot]/themes/butterfly/source/css/_page/homepage.styl æ ·å¼æ–‡ä»¶å†…å®¹
ï¼ˆ + å·ç›´æ¥åˆ é™¤ å³æ˜¯æ­£å¸¸ç¼©è¿›ï¼‰
``` STYL
+if hexo-config('essay.enable') && hexo-config('essay.home_mini')
+  .essay-mini
+    background: var(--card-bg)
+    color: var(--font-color)
+    padding: 0.5rem 1rem
+    border-radius: 8px
+    box-shadow: var(--icat-shadow-border)
+    display: flex
+    border: var(--style-border)
+    align-items: center
+    height: 50px
+    animation: slide-in 0.6s 0.4s backwards
+    will-change: transform
+    transition: .6s
+
+    &:hover
+      border: var(--style-border-hover-always)
+
+    #Essay
+      overflow: hidden
+      width: 100%
+      overflow: hidden
+      text-overflow: ellipsis
+      white-space: nowrap
+
+      #essay-mini
+        width: 100%
+        height: 25px
+        line-height: 25px
+        display: flex
+        flex-direction: column
+
+      .li-style
+        width: auto
+        max-width: 100%
+        height: 25px
+        text-align: center
+        overflow: hidden
+        text-overflow: ellipsis
+        font-weight: 700
+        margin: auto
+        cursor: pointer
+        white-space: nowrap
+        user-select: none
+
+    i, .li-style
+      transition: .6s
+      cursor: pointer
+
+      &:hover
+        color: var(--icat-blue)

#recent-posts
  & > .recent-post-item:not(:first-child)

  Â·Â·Â·
```
{% folding cyan, å¯é€‰CSSæ ·å¼ %}

æ–°å¢ [blogRoot]/source/css/essay.css æ ·å¼æ–‡ä»¶å†…å®¹
ï¼ˆä¹Ÿå¯ä»¥åœ¨è‡ªå»ºçš„cssæ–‡ä»¶é‡Œæ–°å¢å†…å®¹ï¼‰
``` CSS
.essay-mini {
  background: var(--card-bg);
  color: var(--font-color);
  padding: 0.5rem 1rem;
  border-radius: 8px;
  -webkit-box-shadow: var(--icat-shadow-border);
  box-shadow: var(--icat-shadow-border);
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  border: var(--style-border);
  -webkit-box-align: center;
  -moz-box-align: center;
  -o-box-align: center;
  -ms-flex-align: center;
  -webkit-align-items: center;
  align-items: center;
  height: 50px;
  -webkit-animation: slide-in 0.6s 0.4s backwards;
  -moz-animation: slide-in 0.6s 0.4s backwards;
  -o-animation: slide-in 0.6s 0.4s backwards;
  -ms-animation: slide-in 0.6s 0.4s backwards;
  animation: slide-in 0.6s 0.4s backwards;
  will-change: transform;
  -webkit-transition: 0.6s;
  -moz-transition: 0.6s;
  -o-transition: 0.6s;
  -ms-transition: 0.6s;
  transition: 0.6s;
}
.essay-mini:hover {
  border: var(--style-border-hover-always);
}
.essay-mini #Essay {
  overflow: hidden;
  width: 100%;
  overflow: hidden;
  -o-text-overflow: ellipsis;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.essay-mini #Essay #essay-mini {
  width: 100%;
  height: 25px;
  line-height: 25px;
  display: -webkit-box;
  display: -moz-box;
  display: -webkit-flex;
  display: -ms-flexbox;
  display: box;
  display: flex;
  -webkit-box-orient: vertical;
  -moz-box-orient: vertical;
  -o-box-orient: vertical;
  -webkit-flex-direction: column;
  -ms-flex-direction: column;
  flex-direction: column;
}
.essay-mini #Essay .li-style {
  width: auto;
  max-width: 100%;
  height: 25px;
  text-align: center;
  overflow: hidden;
  -o-text-overflow: ellipsis;
  text-overflow: ellipsis;
  font-weight: 700;
  margin: auto;
  cursor: pointer;
  white-space: nowrap;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.essay-mini i,
.essay-mini .li-style {
  -webkit-transition: 0.6s;
  -moz-transition: 0.6s;
  -o-transition: 0.6s;
  -ms-transition: 0.6s;
  transition: 0.6s;
  cursor: pointer;
}
.essay-mini i:hover,
.essay-mini .li-style:hover {
  color: var(--icat-blue);
}

/* å³åˆ»miniæ ·å¼ */
```
{% endfolding %}
(3).æ–°å»ºjsæ–‡ä»¶

æ–°å¢ [blogRoot]/source/js/essay.js æ–‡ä»¶å†…å®¹
ï¼ˆæˆ–å†™åœ¨è‡ªå»ºçš„å…¬å…± js ä¸­ä¹Ÿå¯ä»¥ï¼‰
``` JS
function whenDOMReady() {
	initEssay();
};

whenDOMReady()
document.addEventListener("pjax:complete", whenDOMReady)

function initEssay() {
  if (document.querySelector('#essay-mini')) {
    let swiper = new Swiper('.swiper-container', {
        direction: 'vertical',
        loop: true,
        autoplay: {
            delay: 3000,
            pauseOnMouseEnter: true
        },
    });
  }
} // Swiperè½®æ’­ - å³åˆ»mini
```
åœ¨ _config.butterfly.yml ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­ inject ä¸‹çš„ bottom å¼•å…¥ essay.js å’Œ waterfall.js
``` YML
  Â·Â·Â·

inject:
  head:
    - Â·Â·Â·
  bottom:
    - <script src="https://cdn.staticfile.net/Swiper/10.3.1/swiper-bundle.min.js"></script> # Swiper - è½®æ’­åŠ¨ç”»åº“

  Â·Â·Â·
```

## éšé£èµ·ï¼ˆå³åˆ»çŸ­æ–‡ï¼‰
### æ”¯æŒç±»å‹

**åˆ—è¡¨**	     | **æ˜¯å¦æ”¯æŒ**
---------------|----------------
**å›¾ç‰‡**       |	âœ…
**é“¾æ¥**       |	âœ…
**éŸ³ä¹**       |	âœ…
**ç€‘å¸ƒæµ**     |	âœ…
**é¦–é¡µæ»šåŠ¨**   |	âœ…
**ä½ç½®ä¿¡æ¯**   |	âœ…

### åˆ›å»ºæ•°æ®

åœ¨source/_dataç›®å½•ä¸‹åˆ›å»ºessay.ymlï¼š
``` YML
- class_name: å³åˆ»çŸ­æ–‡
  essay_list:
    - content: æ–‡ç« æ¨èå¡ç‰‡æ•™ç¨‹æ¨å‡º
      image: https://cdn.bywind.xyz/img/cover/image-20221221154442479.png
      link: https://blog.bywind.xyz/posts/ab6e072d.html
      location: å±±è¥¿
      date: 2022-12-21
    - content: å…³äºæœ¬ç«™
      link: https://blog.bywind.xyz/about/
      location: å¤©æ´¥
      date: 2022-12-20
    - content: å³åˆ»çŸ­æ–‡å¤´å›¾æ¢æˆè§†é¢‘ï¼Œæ›´æ˜¾åŠ¨æ€æ„Ÿ
      date: 2022-12-19 23:07:23
    - content: æè£æµ©çš„æ­Œè¿˜æ˜¯é‚£ä¹ˆå¥½å¬ï¼Œä¸¤äººé…åˆå¤ªæ£’äº†ï¼
      music:
        server: tencent
        id: 001wG84E4bOj3V
      date: 2022-12-19 08:07:23
```
### é…ç½®å‚æ•°ä»‹ç»

**å‚æ•°**                                     |	**å«ä¹‰**
---------------------------------------------|---------------------------------------------
**content**                                  |	å³åˆ»çŸ­æ–‡å†…å®¹
**image**                                    |	å›¾ç‰‡
**link**                                     |	é“¾æ¥
**music.server**                             |	éŸ³ä¹æœåŠ¡å•†ï¼ˆtencentQQï¼Œneteaseç½‘æ˜“äº‘ï¼Œ,kugoué…·ç‹—, xiamiè™¾ç±³ï¼‰
**music.id**                                 |	éŸ³ä¹id
**location**                                 |	ä½ç½®ä¿¡æ¯
**date**                                     |	æ—¥æœŸ

### åˆ›å»ºmdé¡µé¢
åˆ›å»ºmdé¡µé¢ï¼Œåœ¨æ§åˆ¶å°è¾“å…¥hexo new page essayï¼Œç”Ÿæˆæ–‡ä»¶åœ¨source/essay/index.md
``` MARKDOWN
---
title: å³åˆ»çŸ­æ–‡
date: 2022-12-20 22:06:17
comments: true
aside: false
top_img: false
type: essay
---
```

### åˆ›å»ºé¡µé¢æ–‡ä»¶

åœ¨themes/butterfly/layout/includes/pageç›®å½•ä¸‹åˆ›å»ºessay.pug
``` PUG
.author-content.author-content-item.essayPage.single.essayVideo
    .card-content
        .author-content-item-tips å³åˆ»çŸ­æ–‡
        span.author-content-item-title åˆ†äº«ç”Ÿæ´»çš„å°ç¡®å¹¸
        .content-bottom
            .tips ä½¿ç”¨ å³åˆ»çŸ­æ–‡é™æ€éƒ¨ç½²ç‰ˆ æ„å»º
        .banner-button-group
            a.banner-button(onclick='pjax.loadUrl("/about/")', data-pjax-state)
                i.fas.fa-circle-chevron-right
                span.banner-button-text éƒ¨ç½²é¡¹ç›®
#bber
    section.timeline.page-1
        ul#waterfall.list.show
            each i in site.data.essay
                each item, index in i.essay_list
                    if index < 30
                        li.item
                            .bber-content
                                p.datacont= item.content
                                    if item.image
                                        .bber-content-img
                                            a.fancybox(target='_blank', rel='noopener', href=item.image, data-fancybox='gallery', data-caption)
                                                img.bber-content-image-self(src=item.image)
                            if item.music
                                .bber-music
                                    meting-js(server=item.music.server, type='song', id=item.music.id, mutex='true', preload='none', theme='var(--bywind-main)', data-lrctype='0')
                            hr
                            .bber-bottom
                                .bber-info
                                    .bber-info-time
                                        i.fa-solid.fa-calendar-days
                                        - var datedata = new Date(item.date).toISOString()

                                        time.datatime(datetime= item.date)= datedata
                                    if item.link
                                        a.bber-content-link(href=item.link, target="_blank", rel="external nofollow", title="è·³è½¬åˆ°çŸ­æ–‡æŒ‡å¼•çš„é“¾æ¥")
                                            i.fas.fa-link
                                            | é“¾æ¥
                                    - let location = item.location ? item.location : å±±è¥¿
                                    .bber-info-address
                                        i.hnfont.icon-location-fill
                                        span=location
                                a.bber-reply(onclick=`rm.rightMenuCommentText('${item.content}')`)
                                    i.fa-solid.fa-message

#bber-tips(style='color: var(--bywind-secondtext);')
    | - åªå±•ç¤ºæœ€è¿‘30æ¡çŸ­æ–‡ -
```

### ä¿®æ”¹Pageæ–‡ä»¶

ä¿®æ”¹themes/butterfly/layout/page.pug

```PUG
    case page.type
      when 'tags'
        include includes/page/tags.pug
      when 'link'
        include includes/page/flink.pug
+      when 'essay'
+        include includes/page/essay.pug
```

### é¦–é¡µå³åˆ»ï¼ˆå¯é€‰ï¼‰

æ–°å»ºthemes/butterfly/layout/includes/bbTimeList.pug
``` PUG
#bbTimeList.bbTimeList.container
    i.bber-logo.iconfont.icon-bblogo(onclick=`pjax.loadUrl("/essay/")`,title="å³åˆ»çŸ­æ–‡",style="font-size: 2rem;")
    #bbtalk.swiper-container.swiper-no-swiping(tabindex="-1")
        #bber-talk.swiper-wrapper(onclick=`pjax.loadUrl("/essay/")`)
            each i in site.data.essay
                each item, index in i.essay_list
                    if index < 10
                        - var contentText = item.content
                        if item.image
                            - contentText= item.content + ' [å›¾ç‰‡]'
                        else if item.music
                            - contentText= item.content + ' [éŸ³ä¹]'
                        .li-style.swiper-slide= contentText

    i.bber-gotobb.fas.fa-arrow-circle-right(onclick=`pjax.loadUrl("/essay/")`,title="æŸ¥çœ‹å…¨æ–‡")
script(src='https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js',data-pjax='')

```

### é¦–é¡µå³åˆ»ï¼ˆå¯é€‰ï¼‰

(1).æ–°å»ºé¦–é¡µè½®æ’­å†…å®¹

æ–°å»ºthemes/butterfly/layout/includes/bbTimeList.pug

``` PUG
#bbTimeList.bbTimeList.container
    i.bber-logo.iconfont.icon-bblogo(onclick=`pjax.loadUrl("/essay/")`,title="å³åˆ»çŸ­æ–‡",style="font-size: 2rem;")
    #bbtalk.swiper-container.swiper-no-swiping(tabindex="-1")
        #bber-talk.swiper-wrapper(onclick=`pjax.loadUrl("/essay/")`)
            each i in site.data.essay
                each item, index in i.essay_list
                    if index < 10
                        - var contentText = item.content
                        if item.image
                            - contentText= item.content + ' [å›¾ç‰‡]'
                        else if item.music
                            - contentText= item.content + ' [éŸ³ä¹]'
                        .li-style.swiper-slide= contentText

    i.bber-gotobb.fas.fa-arrow-circle-right(onclick=`pjax.loadUrl("/essay/")`,title="æŸ¥çœ‹å…¨æ–‡")
script(src='https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.js',data-pjax='')
```
(2).å¼•å…¥åˆ°ä¸»é¡µ

``` PUG
block content
  include ./includes/mixins/post-ui.pug
  #recent-posts.recent-posts
    include includes/categoryList.pug
+    include includes/bbTimeList.pug
    +postUI
    include includes/pagination.pug
```

(3).å¼•å…¥æ ·å¼æ–‡ä»¶
``` YML
inject:
  head:
		- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper/swiper-bundle.min.css">
		- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/bb/showbb_in_index.css">
		- <script src="https://cdn.staticaly.com/gh/haonan15/CDN@main/source/waterfall.min.js"></script> # ç€‘å¸ƒæµ
```

(4).æ·»åŠ è‡ªå®šä¹‰js
``` JS
if (document.querySelector('#bber-talk')) {
      var swiper = new Swiper('.swiper-container', {
        direction: 'vertical', 
        loop: true,
        autoplay: {
        delay: 3000,
        pauseOnMouseEnter: true
      },
      });
    }
```

(5).æ·»åŠ CSSæ–‡ä»¶
``` CSS
#bber>section>ul>li>div .bber-info-time ,
#bber > section > ul > li > div .bber-info-address{
    color: var(--bywind-fontcolor);
    font-size: 0.7rem;
    background-color: var(--bywind-gray-op);
    padding: 0 8px;
    border-radius: 20px;
    cursor: default;
    display: flex;
    align-items: center;
}

#bber>section>ul>li>div .bber-info-time i ,
#bber > section > ul > li > div .bber-info-address i{
    margin-right: 8px;
    font-size: 16px;
}
#bber > section > ul > li > div .bber-info-address {
    margin-left: 0.5rem;
}
```

## å®‰çŸ¥é±¼ï¼ˆå³åˆ»çŸ­æ–‡ï¼‰
### åŠŸèƒ½å¯¹æ¯”

**todolist**              |	**æ”¯æŒåº¦**
--------------------------|--------------------------
**å›¾ç‰‡ç¯ç®±**              |   âœ…
**å¤šå›¾ç‰‡å¤šè¡Œæ˜¾ç¤º**        |	  âœ…
**å¤–éƒ¨é“¾æ¥**              |  âœ…
**ç€‘å¸ƒæµ**                |	 âœ…
**é¦–é¡µæ»šåŠ¨**              |	 âœ…
**å¿«é€Ÿè¯„è®º**              |	 âœ…
**æœ¬åœ°ä¿®æ”¹ymlå‘å¸ƒ**       |	 âœ…
**aplayer**               |	âœ… 
**å•æ›²éŸ³ä¹**              |  âœ…
**æ’ä»¶ç‰ˆæœ¬**	            |  âŒ

### æ·»åŠ é¢œè‰²å†…å®¹
è¯¦æƒ…å¯ä»¥å‰å¾€è¿™ä¸ªæ–‡ç« æŸ¥çœ‹[é¢œè‰²æ ·å¼](https://www.sxiaohe.top/posts/2013454d.html)

### åˆ›å»ºæ•°æ®

åˆ›å»º source/_data/essay.yml

``` YML
- class_name: å³åˆ»çŸ­æ–‡
  essay_list:
    - content: ç»ˆäºæŠŠç›¸å†Œé›†æå®šäº†, è€¶âœŒï¸, ç€‘å¸ƒæµåœ¨æ»‘åŠ¨æ»šåŠ¨æ¡ä¸€ä¸ªè§†å£èŒƒå›´ä¸Šä¸‹100çš„æƒ…å†µæ‰§è¡Œä¸€æ¬¡, åˆ°åº•éƒ¨åœæ­¢ç›‘å¬è®©æ€§èƒ½é«˜äº†å¥½å¤šï¼Œå†ä¹Ÿä¸ä¼šå¸ƒå±€æ··ä¹±ğŸ¤ªäº†
      date: 2022/10/25
      link: https://blog.anheyu.com/album/
    - content: æœç´¢ğŸ”æ”¯æŒç¼©ç•¥å›¾æ˜¾ç¤ºå•¦ï¼ˆé»˜è®¤è·å–æ–‡ç« å†…å®¹çš„ç¬¬ä¸€å¼ å›¾ç‰‡ï¼‰
      date: 2022/10/23 08:00:00
      from: å®‰çŸ¥é±¼
    - content: é‡è§å½©è™¹ğŸŒˆåƒå®šå½©è™¹
      date: 2022/10/23 10:00:00
      image:
        - https://img02.anheyu.com/adminuploads/1/2022/10/23/6354ea92960ef.webp
    - content: ThreeJs APIçœŸå¤šä¸«
      date: 2022/10/19
    - content: æ­Œæ›²æ¨è
      date: 2022/09/25
      aplayer:
        server: tencent
        id: 001FGQba3i10mw
```

### æ•°æ®å‚æ•°é‡Šä¹‰

**å‚æ•°** 	                       | **å¤‡é€‰å€¼/ç±»å‹**             |	**é‡Šä¹‰**
---------------------------------|----------------------------|---------------------------------------------------------------
**class_name**                   |	String	                  |  ã€å¯é€‰ã€‘æ ‡è¯†ç¬¦ï¼Œæ— å®é™…æ„ä¹‰ï¼Œé€‰å¡«
**essay_list**                   |	Array		                  |  ã€å¿…é€‰ã€‘å³åˆ»çŸ­æ–‡æ•°æ®åˆ—è¡¨
**essay_list.content**           |	String	                  |	 ã€å¿…é€‰ã€‘çŸ­æ–‡ æ–‡å­—å†…å®¹
**essay_list.date**              |	Time		                  |  ã€å¿…é€‰ã€‘çŸ­æ–‡å‘å¸ƒæ—¶é—´ æ ¼å¼å»ºè®®ä¸º 2022/10/26 08:00:00
**essay_list.image**             |	Array		                  |  ã€å¯é€‰ã€‘çŸ­æ–‡å›¾ç‰‡å†…å®¹, å¯å¡«å†™å¤šå¼ å›¾ç‰‡
**essay_list.from**              |	String	                  |	 ã€å¯é€‰ã€‘çŸ­æ–‡ æ¥è‡ªä½•å¤„, å½“ç„¶ä¹Ÿå¯ä»¥å¡«ä»»ä½•ä½ æƒ³å¡«å†™çš„æ ‡è¯†
**essay_list.link**              |  String	                  |	 ã€å¯é€‰ã€‘å¤–éƒ¨é“¾æ¥
**essay_list.aplayer**           |	Array		                  |  ã€å¯é€‰ã€‘aplayer æ’­æ”¾å™¨çš„å•æ›²éŸ³ä¹, éœ€ aplayer æ”¯æŒ
**essay_list.aplayer.server**    |	String	                  |	 ã€essay_list.aplayer åå¿…é€‰ã€‘aplayer æœåŠ¡å•†
**essay_list.aplayer.id**        |	String	                  |  ã€essay_list.aplayer åå¿…é€‰ã€‘å•æ›² id

### åˆ›å»º md é¡µé¢æ–‡ä»¶

åˆ›å»ºsource/essay/index.md æ¥ç”Ÿæˆé¡µé¢ page
``` MARKDOWN
---
title: å³åˆ»çŸ­æ–‡
date: 2020-07-22 22:06:17
comments: true
aside: false
top_img: false
type: essay
---
```

### åˆ›å»º dom æ–‡ä»¶
åˆ›å»ºthemes/butterfly/layout/includes/page/essay.pug, é¡µé¢å†…å®¹, æ³¨æ„è¯¥é¡µé¢ä¸­å¯èƒ½å­˜åœ¨éƒ¨åˆ†fontawesome å›¾æ ‡éœ€è¦è‡ªè¡Œæ›¿æ¢ã€‚
``` PUG
#essay_page
  .author-content.author-content-item.essayPage.single
    .card-content
      .author-content-item-tips å³åˆ»çŸ­æ–‡
      span.author-content-item-title å’¸é±¼çš„æ—¥å¸¸ç”Ÿæ´»ã€‚
      .content-bottom
        .tips ä½¿ç”¨ å³åˆ»çŸ­æ–‡é™æ€éƒ¨ç½²ç‰ˆ æ„å»º
      .banner-button-group
        a.banner-button(onclick='pjax.loadUrl("/about/")', data-pjax-state)
          i.fas.fa-circle-right(style='font-size: 1.5rem')
          span.banner-button-text å…³äºæˆ‘
  #bber
    section.timeline.page-1
      ul#waterfall.list
        each i in site.data.essay
          each item, index in i.essay_list
            if index < 30
              li.bber-item
                .bber-content
                  p.datacont= item.content
                    if item.image
                      .bber-container-img
                        each iten, indey in item.image
                          a.bber-content-img(href=item.image[indey], target="_blank", data-fancybox="gallery", data-caption="")
                            img(src=item.image[indey])
                        .bber-content-noimg
                        .bber-content-noimg
                        .bber-content-noimg
                    if item.aplayer
                      .bber-music
                        .aplayer.no-destroy(data-id=item.aplayer.id data-server=item.aplayer.server data-type="song"  data-order="list" data-preload="none" data-autoplay="false" data-mutex="true" data-theme='var(--anzhiyu-main)')
                hr
                .bber-bottom
                  .bber-info
                    .bber-info-time
                      - var datedata = new Date(item.date).toISOString()
                      i.far.fa-clock
                      time.datatime(datetime= item.date)= datedata
                    if item.link
                      a.bber-content-link(target="_blank", title="è·³è½¬åˆ°çŸ­æ–‡æŒ‡å¼•çš„é“¾æ¥", href=item.link, rel="external nofollow")
                        i.fas.fa-link
                        | é“¾æ¥
                    if item.from
                      .bber-info-from
                        i.fas.fa-fire
                        span=item.from
                  .bber-reply(onclick="anzhiyu.commentText(" + `'${item.content}'` + ")")
                    i.fa-solid.fa-message
  #bber-tips(style='color: var(--anzhiyu-secondtext);')
    | - åªå±•ç¤ºæœ€è¿‘30æ¡çŸ­æ–‡ -
```

### ä¿®æ”¹ Page æ–‡ä»¶
ä¿®æ”¹themes/butterfly/layout/page.pug æ¥ä½¿é¡µé¢å†…å®¹åŒ¹é…
åœ¨ case page.type å­é¡¹é‡Œé¢æ·»åŠ , æ³¨æ„ç¼©è¿›
``` pug
    case page.type
+     when 'essay'
+       include includes/page/essay.pug
      when 'tags'
        include includes/page/tags.pug
      when 'link'
        include includes/page/flink.pug
      when 'categories'
        include includes/page/categories.pug
```

### åŠ å…¥ css
åˆ›å»ºsource/css/essay_page/essay_page.css, ç„¶ååœ¨_config.butterfly.ymlä¸­çš„injectä¸‹çš„headå¼•å…¥, æ³¨æ„ç¼©è¿›
``` YML
inject:
  head:
    - <link rel="stylesheet" href="/css/essay_page/essay_page.css">
```
``` CSS
#page:has(#essay_page) {
  border: 0;
  box-shadow: none !important;
  padding: 0 !important;
  background: transparent !important;
}
#page:has(#essay_page) .page-title {
  display: none;
}
#web_bg ~ .page:has(#essay_page) {
  background: var(--anzhiyu-background);
}
#bber .bber-container-img {
  display: flex;
  align-items: center;
  justify-content: space-around;
  width: 100%;
  flex-wrap: wrap;
  margin-bottom: 0.3rem;
}
#bber .bber-container-img .bber-content-noimg {
  width: calc(100% / 4 - 5px);
}

#bber .bber-content-img img {
  object-fit: cover;
  max-height: 100%;
  border-radius: 12px;
}

#bber .bber-content-img {
  height: 100px;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  position: relative;
  width: calc(100% / 4 - 5px);
  margin-bottom: 10px;
}

#bber .bber-content .datacont {
  order: 0;
  font-size: 0.8rem;
  font-weight: 700;
  color: var(--anzhiyu-fontcolor);
  width: 100%;
  line-height: 1.38;
  border-radius: 12px;
  margin-bottom: 0.5rem;
  display: flex;
  flex-direction: column;
  text-align: justify;
}
#bber p {
  margin: 0px;
}
#bber div.bber-content {
  display: flex;
  flex-flow: wrap;
  border-radius: 12px;
  width: 100%;
  height: 100%;
}
#bber .timeline ul li.bber-item {
  position: relative;
  width: 32%;
  border: var(--style-border-always);
  border-radius: 12px;
  padding: 1rem 1rem 0.5rem;
  transition: all 0.3s ease 0s;
  display: flex;
  flex-flow: column nowrap;
  justify-content: space-between;
  align-items: flex-start;
  background: var(--anzhiyu-card-bg);
  box-shadow: var(--anzhiyu-shadow-border);
  margin-right: 2%;
}
#bber .timeline #waterfall.show {
  opacity: 1;
}
#bber .timeline #waterfall {
  opacity: 0;
  transition: all 0.3s ease 0s;
}
#bber ul.list {
  display: flex;
  flex-flow: row wrap;
  justify-content: space-between;
}
#bber {
  margin-top: 1rem;
  width: 100%;
}
#bber > section > ul > li.bber-item {
  margin-bottom: 1rem;
}

#bber-tips {
  font-size: 14px;
  display: flex;
  justify-content: center;
  margin-top: 1rem;
}

#bber .timeline ul li.bber-item hr {
  display: flex;
  position: relative;
  margin: 8px 0px;
  border: 1px dashed var(--anzhiyu-theme-op);
  width: 100%;
}

#bber .bber-info {
  display: flex;
  align-items: center;
}

#bber > section > ul > li > div .bber-info-time,
#bber > section > ul > li > div .bber-info-from {
  color: var(--anzhiyu-fontcolor);
  font-size: 0.7rem;
  background-color: var(--anzhiyu-gray-op);
  padding: 0px 8px;
  border-radius: 20px;
  cursor: default;
  display: flex;
  align-items: center;
}

#bber .bber-info .far.fa-clock {
  margin-right: 4px;
}
#bber > section > ul > li > div .bber-info-from span,
#bber > section > ul > li > div .bber-info-from {
  margin-left: 4px;
}

#bber .bber-bottom {
  display: flex;
  justify-content: space-between;
  width: 100%;
  margin-top: 10px;
}

#bber .bber-bottom .bber-reply {
  cursor: pointer;
}

#bber .timeline ul li.bber-item:hover {
  border: var(--style-border-hover);
}

#bber .bber-content-link {
  display: flex;
  margin-left: 0.5rem;
  font-size: 0.7rem;
  align-items: center;
  background-color: rgba(245, 108, 108, 0.13);
  color: rgb(245, 108, 108);
  padding: 0px 8px;
  border-radius: 20px;
}
#bber .bber-content-link i {
  margin-right: 3px;
}
#bber .bber-content-link:hover {
  background-color: var(--anzhiyu-main);
  color: var(--anzhiyu-white);
}
#bber .bber-music {
  width: 100%;
  height: 90px;
  margin: 0.5rem 0;
  border-radius: 8px;
  overflow: hidden;
  border: var(--style-border-always);
  background: var(--anzhiyu-secondbg);
}
#bber .aplayer {
  margin: 0;
}

#bber .aplayer.aplayer-withlrc .aplayer-pic {
  height: 82px;
  width: 82px;
  margin: 4px;
  border-radius: 4px;
}
.bber-music .aplayer.aplayer-withlrc .aplayer-info {
  padding: 5px 7px 0;
}
#bber .aplayer .aplayer-info .aplayer-music {
  height: 23px;
}
#bber .aplayer .aplayer-info .aplayer-music .aplayer-title {
  font-size: 0.8rem;
  font-weight: 700;
  margin: 0;
  color: var(--anzhiyu-fontcolor);
}

#bber .aplayer .aplayer-info .aplayer-controller {
  align-items: center;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap {
  padding: 0;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-time {
  position: initial;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar {
  background: var(--anzhiyu-gray);
  height: 8px;
  border-radius: 12px;
  transition: 0.3s;
  overflow: hidden;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-loaded {
  height: 100%;
  border-radius: 12px;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-played {
  height: 100%;
  border-radius: 12px;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar .aplayer-played .aplayer-thumb {
  display: none;
}
#bber .aplayer .aplayer-info .aplayer-controller .aplayer-time {
  position: initial;
}

/* é¡¶éƒ¨æ ·å¼ */
.author-content.author-content-item.essayPage {
  height: 19rem;
  background: url(https://img02.anheyu.com/adminuploads/1/2022/08/21/630249e2df20f.jpg) left 28% / cover no-repeat;
  color: var(--anzhiyu-white);
  overflow: hidden;
  margin-top: 0px;
}
#page:has(#essay_page) .author-content-item .card-content .banner-button-group .banner-button:hover {
  color: var(--anzhiyu-white);
  border-radius: 20px !important;
}

/* å“åº”å¼ */
@media screen and (max-width: 1300px) {
  #bber .timeline ul li.bber-item {
    width: 49%;
    margin-right: 1%;
  }
}
@media screen and (max-width: 768px) {
  #bber .timeline ul li.bber-item {
    width: 100%;
    margin-right: 0px;
  }
}
[data-theme="dark"] #bber .bber-music .aplayer,
[data-theme="dark"] #bber .aplayer .aplayer-lrc:before,
[data-theme="dark"] #bber .aplayer .aplayer-lrc:after {
  background: var(--anzhiyu-card-bg);
  color: var(--anzhiyu-fontcolor);
}
#bber .aplayer .aplayer-lrc p {
  color: var(--anzhiyu-fontcolor);
}
```
### js å¤„ç†
æ–°å»ºä¸€ä¸ª js æ–‡ä»¶ç”¨æ¥å¤„ç†å³åˆ»çŸ­æ–‡çš„é€»è¾‘, æˆ–è€…å†™åœ¨å…¬å…± js ä¸­ä¹Ÿå¯ä»¥, åšä¸»å†™åœ¨å…¬å…± js ä¸­, å³custom.js, è¯¥ js åœ¨_config.butterfly.ymlä¸­çš„injectä½¿ç”¨å¦‚ä¸‹æ–¹å¼å¼•å…¥, åŠ å…¥äº†data-pjax, å¹¶ä¸”å¼€å¯äº†ç«™ç‚¹çš„pjax, ç„¶åå†å¼•å…¥waterfall.jsç”¨äºå¤„ç†ç€‘å¸ƒæµã€‚
``` YML
inject:
  bottom:
    - <script async data-pjax src="/js/custom.js"></script>
    # å³åˆ»ä¾èµ–waterfall
    - <script async data-pjax src="/js/waterfall/waterfall.js"></script>
```
``` YML
# Pjax
# It may contain bugs and unstable, give feedback when you find the bugs.
# https://github.com/MoOx/pjax
pjax:
  enable: true
  exclude:
```
æ–°å»º source/js/waterfall/waterfall.js å†…å®¹å¦‚ä¸‹
``` JS
function waterfall(a) {
  function b(a, b) {
    var c = window.getComputedStyle(b);
    return parseFloat(c["margin" + a]) || 0;
  }
  function c(a) {
    return a + "px";
  }
  function d(a) {
    return parseFloat(a.style.top);
  }
  function e(a) {
    return parseFloat(a.style.left);
  }
  function f(a) {
    return a.clientWidth;
  }
  function g(a) {
    return a.clientHeight;
  }
  function h(a) {
    return d(a) + g(a) + b("Bottom", a);
  }
  function i(a) {
    return e(a) + f(a) + b("Right", a);
  }
  function j(a) {
    a = a.sort(function (a, b) {
      return h(a) === h(b) ? e(b) - e(a) : h(b) - h(a);
    });
  }
  function k(b) {
    f(a) != t && (b.target.removeEventListener(b.type, arguments.callee), waterfall(a));
  }
  "string" == typeof a && (a = document.querySelector(a));
  var l = [].map.call(a.children, function (a) {
    return (a.style.position = "absolute"), a;
  });
  a.style.position = "relative";
  var m = [];
  l.length && ((l[0].style.top = "0px"), (l[0].style.left = c(b("Left", l[0]))), m.push(l[0]));
  for (var n = 1; n < l.length; n++) {
    var o = l[n - 1],
      p = l[n],
      q = i(o) + f(p) <= f(a);
    if (!q) break;
    (p.style.top = o.style.top), (p.style.left = c(i(o) + b("Left", p))), m.push(p);
  }
  for (; n < l.length; n++) {
    j(m);
    var p = l[n],
      r = m.pop();
    (p.style.top = c(h(r) + b("Top", p))), (p.style.left = c(e(r))), m.push(p);
  }
  j(m);
  var s = m[0];
  a.style.height = c(h(s) + b("Bottom", s));
  var t = f(a);
  window.addEventListener ? window.addEventListener("resize", k) : (document.body.onresize = k);
}
```
custom.jså†…å®¹å¦‚ä¸‹
``` JS
var percentFlag = false; // èŠ‚æµé˜€
function essayScroll() {
  let a = document.documentElement.scrollTop || window.pageYOffset; // å·å»é«˜åº¦
  const waterfallResult = a % document.documentElement.clientHeight; // å·å»ä¸€ä¸ªè§†å£
  result <= 99 || (result = 99);

  if (
    !percentFlag &&
    waterfallResult + 100 >= document.documentElement.clientHeight &&
    document.querySelector("#waterfall")
  ) {
    // console.info(waterfallResult, document.documentElement.clientHeight);
    setTimeout(() => {
      waterfall("#waterfall");
    }, 500);
  } else {
    setTimeout(() => {
      document.querySelector("#waterfall") && waterfall("#waterfall");
    }, 500);
  }

  const r = window.scrollY + document.documentElement.clientHeight;

  let p = document.getElementById("post-comment") || document.getElementById("footer");

  (p.offsetTop + p.offsetHeight / 2 < r || 90 < result) && (percentFlag = true);
}
function replaceAll(e, n, t) {
  return e.split(n).join(t);
}
var anzhiyu = {
  diffDate: function (d, more = false) {
    const dateNow = new Date();
    const datePost = new Date(d);
    const dateDiff = dateNow.getTime() - datePost.getTime();
    const minute = 1000 * 60;
    const hour = minute * 60;
    const day = hour * 24;
    const month = day * 30;

    let result;
    if (more) {
      const monthCount = dateDiff / month;
      const dayCount = dateDiff / day;
      const hourCount = dateDiff / hour;
      const minuteCount = dateDiff / minute;

      if (monthCount >= 1) {
        result = datePost.toLocaleDateString().replace(/\//g, "-");
      } else if (dayCount >= 1) {
        result = parseInt(dayCount) + " " + GLOBAL_CONFIG.date_suffix.day;
      } else if (hourCount >= 1) {
        result = parseInt(hourCount) + " " + GLOBAL_CONFIG.date_suffix.hour;
      } else if (minuteCount >= 1) {
        result = parseInt(minuteCount) + " " + GLOBAL_CONFIG.date_suffix.min;
      } else {
        result = GLOBAL_CONFIG.date_suffix.just;
      }
    } else {
      result = parseInt(dateDiff / day);
    }
    return result;
  },
  changeTimeInEssay: function () {
    document.querySelector("#bber") &&
      document.querySelectorAll("#bber time").forEach(function (e) {
        var t = e,
          datetime = t.getAttribute("datetime");
        (t.innerText = anzhiyu.diffDate(datetime, true)), (t.style.display = "inline");
      });
  },
  reflashEssayWaterFall: function () {
    document.querySelector("#waterfall") &&
      setTimeout(function () {
        waterfall("#waterfall");
        document.getElementById("waterfall").classList.add("show");
      }, 500);
  },
  commentText: function (e) {
    if (e == "undefined" || e == "null") e = "å¥½æ£’ï¼";
    var n = document.getElementsByClassName("el-textarea__inner")[0],
      t = document.createEvent("HTMLEvents");
    if (!n) return;
    t.initEvent("input", !0, !0);
    var o = replaceAll(e, "\n", "\n> ");
    (n.value = "> " + o + "\n\n"), n.dispatchEvent(t);
    var i = document.querySelector("#post-comment").offsetTop;
    window.scrollTo(0, i - 80),
      n.focus(),
      n.setSelectionRange(-1, -1),
      document.getElementById("comment-tips") && document.getElementById("comment-tips").classList.add("show");
  },
};

anzhiyu.changeTimeInEssay();
anzhiyu.reflashEssayWaterFall();
```
å…¶ä¸­anzhiyuå˜é‡ä¸­å­˜å‚¨çš„å››ä¸ªæ–¹æ³•
**å˜é‡**                     | **å˜é‡ç‰¹ç‚¹**
-----------------------------|---------------------------------------------------------------------------
**diffDate**                 |  ä¸ºå¤„ç†æ—¶é—´çš„æ–¹æ³•,å…¶å® btf ä¸­ä¹Ÿæœ‰,åªæ˜¯ä¸å¤ªå–œæ¬¢é‚£ä¸ªçš„æ˜¾ç¤ºæ–¹å¼,å°±æ”¹æˆç°åœ¨è¿™ä¸ªäº†ã€‚
**changeTimeInEssay**        |  åˆå§‹åŒ–å³åˆ»æ—¶é—´
**reflashEssayWaterFall**    |  å¤„ç†ç€‘å¸ƒæµæ˜¾ç¤º
**commentText**              |  å¤„ç†ç‚¹å‡»è·³è½¬è¯„è®ºå¹¶æ·»åŠ è¯„è®º

æ–¹æ³•essayScrollä¸ºæ£€æŸ¥æ»šåŠ¨æ¡å·å»ä¸€ä¸ªè§†å£é«˜åº¦çš„ 100 èŒƒå›´å†…æ‰§è¡Œä¸€æ¬¡, æ»‘åŠ¨åˆ°åº•éƒ¨æˆ–è¯„è®ºåŒºå–æ¶ˆç›‘å¬æ‰§è¡Œã€‚æ­¤å¤„åšä¸»æœªåš else å¤„ç†å–æ¶ˆç›‘å¬, å¦‚æœæœ‰å†™percentå‡½æ•°ç›‘å¬æ»‘åŠ¨å¯ä»¥ä¸€èµ·å†™åœ¨åŒä¸€ä¸ªæ–¹æ³•é‡Œé¢ã€‚ï¼ˆåšä¸»å°±æ˜¯å†™åœ¨åŒä¸€ä¸ªæ–¹æ³•é‡Œé¢ï¼‰, å¦‚æœå³åˆ»æ–‡ç« å¾ˆå°‘çš„è¯å…¶å®æ˜¯å¯ä»¥ä¸ç›‘å¬æ»‘åŠ¨çš„, å³åªæ˜¾ç¤ºè¿‘ 30 æ¡, å› ä¸ºè¿›å…¥é¡µé¢åä¼šæ‰§è¡Œä¸€æ¬¡ç€‘å¸ƒæµ, é¡µé¢ä¸ä¼šä¹±, ä½†æ˜¯å¦‚æœæ‚¨æŠŠ essay.pug ä¸­ 17 è¡Œå·¦å³ä¿®æ”¹åå¯ä»¥è¾¾åˆ°æ— é™çš„æ•ˆæœå°±ä¼šå‡ºç° dom ç»“æ„è¿˜æ²¡æ¸²æŸ“ç€‘å¸ƒæµå°±å·²ç»æ‰§è¡Œå®Œäº†çš„æƒ…å†µå°±éœ€è¦ç›‘å¬æ»šåŠ¨æ¥å†æ¬¡æ‰§è¡Œç€‘å¸ƒæµä»¥å®Œæˆå¸ƒå±€ã€‚

### é¦–é¡µæ»šåŠ¨æ˜¾ç¤ºå³åˆ»(å¯é€‰)
åˆ›å»º themes/butterfly/layout/includes/bbTimeList.pug, éƒ¨åˆ†fontawesomeå›¾æ ‡å¯èƒ½éœ€è¦æ‚¨è‡ªè¡Œä¿®æ”¹ã€‚
``` PUG
#bbTimeList.bbTimeList.container
    svg.icon.bber-logo.iconfont.icon-chrome(onclick=`pjax.loadUrl("/essay/")`,title="å³åˆ»çŸ­æ–‡",aria-hidden="true")
      use(xlink:href="#icon-chrome")
    #bbtalk.swiper-container.swiper-no-swiping.essay_bar_swiper_container(tabindex="-1")
      #bber-talk.swiper-wrapper(onclick=`pjax.loadUrl("/essay/")`)
        each i in site.data.essay
          each item, index in i.essay_list
            if index < 10
              - var contentText = item.image ? item.content + ' [å›¾ç‰‡]' : item.content
              .li-style.swiper-slide= contentText

    i.bber-gotobb.fas.fa-arrow-circle-right(onclick=`pjax.loadUrl("/essay/")`,title="æŸ¥çœ‹å…¨æ–‡")
```

### å¼•å…¥åˆ°ä¸»é¡µ
ä¿®æ”¹themes/butterfly/layout/index.pug, æ³¨æ„ç¼©è¿›
``` PUG
block content
  include ./includes/mixins/post-ui.pug
  #recent-posts.recent-posts
    include includes/categoryList.pug
+   include includes/bbTimeList.pug
    +postUI
    include includes/pagination.pug
```
å¦‚æœéœ€è¦åƒæœ¬ç«™ä¸€æ ·åœ¨æ•´ä¸ªé¡¶éƒ¨å¼•å…¥çš„è¯å¯ä»¥å‚è€ƒä¸‹é¢çš„ä»£ç ï¼Œä¿®æ”¹themes/butterfly/layout/includes/layout.pug
``` PUG
if page.type !== '404'
  #body-wrap(class=pageType)
    include ./header/index.pug
+   if (is_home())
+     include ./bbTimeList.pug
```

### å¼•å…¥ swiper ä¾èµ–
åœ¨_config.butterfly.ymlå¼•å…¥ä¾èµ–, å¦‚æœæœ‰ä½¿ç”¨è½®æ’­å›¾æ’ä»¶çš„è¯æ­¤å¤„æ— éœ€å¼•å…¥
``` YML
inject:
  head:
    - <link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-swiper-anzhiyu@1.0.4/lib/swiper.min.css">
  bottom:
    - <script data-pjax src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/js/swiper.min.js"></script>
```
### æ·»åŠ è‡ªå®šä¹‰ css
åˆ›å»ºsource/css/essay_page/home_essay_bar.css, ç„¶ååœ¨_config.butterfly.ymlä¸­çš„injectä¸‹çš„headå¼•å…¥, æ³¨æ„ç¼©è¿›
``` YML
inject:
  head:
    - <link rel="stylesheet" href="/css/essay_page/home_essay_bar.css">
```
``` CSS
#bbTimeList {
  background: var(--anzhiyu-white);
  color: var(--anzhiyu-fontcolor);
  padding: 0.5rem 1rem;
  border-radius: 30px;
  box-shadow: var(--anzhiyu-shadow-lightblack);
  display: flex;
  transition: all 0.3s ease 0s;
  margin: 1rem auto 0;
  border: var(--style-border);
  align-items: center;
  height: 50px;
  width: 100%;
}
[data-theme="dark"] #bbTimeList {
  background: #000 !important;
}
#bbtalk {
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#bber-talk {
  width: 100%;
  height: 25px;
  line-height: 25px;
  display: flex;
  flex-direction: column;
}
.bber-logo {
  font-size: 1.5rem;
  line-height: 22px;
  margin-right: 1rem;
  transition: all 0.3s ease 0s;
  cursor: pointer;
}

.bber-gotobb {
  line-height: 25px;
  margin-left: 1rem;
  transition: all 0.3s ease 0s;
  cursor: pointer;
}

#bber-talk .li-style {
  width: 100%;
  max-width: 100%;
  height: 25px;
  text-align: center;
  overflow: hidden;
  text-overflow: ellipsis;
  transition: 0.3s;
  font-weight: 700;
  margin: auto;
  cursor: pointer;
  white-space: nowrap;
}

#bbTimeList:hover {
  border: var(--style-border-hover);
  box-shadow: var(--anzhiyu-shadow-main);
}

/* æ–‡ç« é¡µH1-H6å›¾æ ‡æ ·å¼æ•ˆæœ */
.bbTimeList .bber-logo {
  -webkit-animation: rotate 1.6s linear infinite;
  animation: rotate 1.6s linear infinite;
}
@-webkit-keyframes rotate {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  to {
    -webkit-transform: rotate(-1turn);
    transform: rotate(-1turn);
  }
}
@keyframes rotate {
  0% {
    -webkit-transform: rotate(0deg);
    transform: rotate(0deg);
  }
  to {
    -webkit-transform: rotate(-1turn);
    transform: rotate(-1turn);
  }
}
```

### ä¿®æ”¹è‡ªå®šä¹‰ js
ä¿®æ”¹custom.js
``` JS
var percentFlag = false; // èŠ‚æµé˜€
function essayScroll() {
  let a = document.documentElement.scrollTop || window.pageYOffset; // å·å»é«˜åº¦
  const waterfallResult = a % document.documentElement.clientHeight; // å·å»ä¸€ä¸ªè§†å£
  result <= 99 || (result = 99);

  if (
    !percentFlag &&
    waterfallResult + 100 >= document.documentElement.clientHeight &&
    document.querySelector("#waterfall")
  ) {
    // console.info(waterfallResult, document.documentElement.clientHeight);
    setTimeout(() => {
      waterfall("#waterfall");
    }, 500);
  } else {
    setTimeout(() => {
      document.querySelector("#waterfall") && waterfall("#waterfall");
    }, 500);
  }

  const r = window.scrollY + document.documentElement.clientHeight;

  let p = document.getElementById("post-comment") || document.getElementById("footer");

  (p.offsetTop + p.offsetHeight / 2 < r || 90 < result) && (percentFlag = true);
}
function replaceAll(e, n, t) {
  return e.split(n).join(t);
}
var anzhiyu = {
  diffDate: function (d, more = false) {
    const dateNow = new Date();
    const datePost = new Date(d);
    const dateDiff = dateNow.getTime() - datePost.getTime();
    const minute = 1000 * 60;
    const hour = minute * 60;
    const day = hour * 24;
    const month = day * 30;

    let result;
    if (more) {
      const monthCount = dateDiff / month;
      const dayCount = dateDiff / day;
      const hourCount = dateDiff / hour;
      const minuteCount = dateDiff / minute;

      if (monthCount >= 1) {
        result = datePost.toLocaleDateString().replace(/\//g, "-");
      } else if (dayCount >= 1) {
        result = parseInt(dayCount) + " " + GLOBAL_CONFIG.date_suffix.day;
      } else if (hourCount >= 1) {
        result = parseInt(hourCount) + " " + GLOBAL_CONFIG.date_suffix.hour;
      } else if (minuteCount >= 1) {
        result = parseInt(minuteCount) + " " + GLOBAL_CONFIG.date_suffix.min;
      } else {
        result = GLOBAL_CONFIG.date_suffix.just;
      }
    } else {
      result = parseInt(dateDiff / day);
    }
    return result;
  },
  changeTimeInEssay: function () {
    document.querySelector("#bber") &&
      document.querySelectorAll("#bber time").forEach(function (e) {
        var t = e,
          datetime = t.getAttribute("datetime");
        (t.innerText = anzhiyu.diffDate(datetime, true)), (t.style.display = "inline");
      });
  },
  reflashEssayWaterFall: function () {
    document.querySelector("#waterfall") &&
      setTimeout(function () {
        waterfall("#waterfall");
        document.getElementById("waterfall").classList.add("show");
      }, 500);
  },
  commentText: function (txt) {
    const postCommentDom = document.querySelector("#post-comment");
    var domTop = postCommentDom.offsetTop;
    window.scrollTo(0, domTop - 80);
    if (txt == "undefined" || txt == "null") txt = "å¥½æ£’ï¼";
    function setText() {
      setTimeout(() => {
        var input = document.getElementsByClassName("el-textarea__inner")[0];
        if (!input) setText();
        let evt = document.createEvent("HTMLEvents");
        evt.initEvent("input", true, true);
        let inputValue = replaceAll(txt, "\n", "\n> ");
        input.value = "> " + inputValue + "\n\n";
        input.dispatchEvent(evt);
        input.focus();
        input.setSelectionRange(-1, -1);
        if (document.getElementById("comment-tips")) {
          document.getElementById("comment-tips").classList.add("show");
        }
      }, 100);
    }
    setText();
  },
  initIndexEssay: function () {
    setTimeout(() => {
      let essay_bar_swiper = new Swiper(".essay_bar_swiper_container", {
        passiveListeners: true,
        direction: "vertical",
        loop: true,
        autoplay: {
          disableOnInteraction: true,
          delay: 3000,
        },
        mousewheel: true,
      });

      let essay_bar_comtainer = document.getElementById("bbtalk");
      if (essay_bar_comtainer !== null) {
        essay_bar_comtainer.onmouseenter = function () {
          essay_bar_swiper.autoplay.stop();
        };
        essay_bar_comtainer.onmouseleave = function () {
          essay_bar_swiper.autoplay.start();
        };
      }
    }, 100);
  },
};

anzhiyu.initIndexEssay();
anzhiyu.changeTimeInEssay();
anzhiyu.reflashEssayWaterFall();
```